{"version":3,"sources":["../src/pictureit_ctrl.js"],"names":["ValueColorMapping","value","colorName","ColorMapping","name","color","Sensor","metric","xlocation","ylocation","format","bgColor","fontColor","size","visible","renderValue","valueFormatted","valueUnit","displayName","link_url","resolvedLink","rectangular","group","Group","alignment","x","y","sameSize","width","normalizeColor","toLowerCase","_","MetricsPanelCtrl","getWidth","interact","panelDefaults","colorMappings","colorMappingMap","valueMappings","metricValues","seriesList","series","bgimage","sensors","groups","useLabelGroupings","height","templateSrv","sizecoefficient","uncache","isTheFirstRender","PictureItCtrl","$scope","$injector","$sce","defaults","panel","events","on","onInitEditMode","bind","render","onDataReceived","dataList","dataListLength","length","push","target","datapoints","refreshImage","Math","random","index","splice","lastSensor","sensor","result","ctrl","map","g","alert","JSON","stringify","addEditorTab","scope","elem","attrs","$panelContainer","find","pixelStrToNum","str","parseInt","substr","getGroup","css","metricMap","keyBy","valueMappingsMap","mapping","dragEventSetup","image","document","getElementById","imageWidth","offsetWidth","sensorWidth","font","newValue","max","panelWidth","ylocationStr","toString","xlocationStr","alignSensors","sizeStr","borderRadius","undefined","replace","effectiveName","mValue","valueMapping","colorMapping","sprintf","window","draggable","inertia","restrict","restriction","endOnly","elementRect","top","left","bottom","right","autoScroll","onmove","event","parseFloat","getAttribute","dx","dy","style","webkitTransform","transform","setAttribute","onend","imageHeight","offsetHeight","xpercentage","ypercentage","newX","round","newY","nextTop","nextX","sensorHeight","renderingCompleted","refreshColorMappings","indexOf","toRemove","split","a","startsWith","endsWith","icon","repeatCount","repeat","slice","imgUrl","imgWidth","imgHeight","join","trustAsHtml","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+ZA,aAASA,iBAAT,CAA2BC,KAA3B,EAC2BC,SAD3B,EACsC;AAClC;;AACA,aAAKD,KAAL,GAAaA,KAAb;AACA,aAAKC,SAAL,GAAiBA,SAAjB;AACH;;AAGD,aAASC,YAAT,CAAsBC,IAAtB,EAA4BC,KAA5B,EAAmC;AAC/B;;AACA,aAAKD,IAAL,GAAYA,IAAZ;AACA,aAAKC,KAAL,GAAaA,KAAb;AACH;;AAED,aAASC,MAAT,CAAgBC,MAAhB,EACgBC,SADhB,EAEgBC,SAFhB,EAGgBC,MAHhB,EAIgBC,OAJhB,EAKgBC,SALhB,EAMgBC,IANhB,EAOgBC,OAPhB,EAOyB;AACrB;;AACA,aAAKP,MAAL,GAAcA,MAAd;AACA,aAAKC,SAAL,GAAiBA,SAAjB;AACA,aAAKC,SAAL,GAAiBA,SAAjB;AACA,aAAKC,MAAL,GAAcA,MAAd;AACA,aAAKC,OAAL,GAAeA,OAAf;AACA,aAAKC,SAAL,GAAiBA,SAAjB;AACA,aAAKC,IAAL,GAAYA,IAAZ;AACA,aAAKC,OAAL,GAAeA,OAAf;AACA,aAAKC,WAAL,GAAmB,KAAnB;AACA,aAAKC,cAAL,GAAsB,EAAtB;AACA,aAAKC,SAAL,GAAiB,EAAjB;AACA,aAAKC,WAAL,GAAmB,EAAnB;AACA,aAAKC,QAAL,GAAgB,EAAhB;AACA,aAAKC,YAAL,GAAoB,EAApB;AACA,aAAKC,WAAL,GAAmB,IAAnB;AACA,aAAKC,KAAL,GAAa,GAAb;AACH;;AAED,aAASC,KAAT,CAAenB,IAAf,EAAqBoB,SAArB,EAAgCC,CAAhC,EAAmCC,CAAnC,EAAsC;AAClC;;AACA,aAAKtB,IAAL,GAAYA,IAAZ;AACA,aAAKoB,SAAL,GAAiBA,SAAjB;AACA,aAAKC,CAAL,GAASA,CAAT;AACA,aAAKC,CAAL,GAASA,CAAT;AACA,aAAKC,QAAL,GAAgB,KAAhB;AACA,aAAKC,KAAL,GAAa,GAAb;AACH;;AAED,aAASC,cAAT,CAAwBxB,KAAxB,EAA+B;;AAE3B,YAAIA,MAAMyB,WAAN,OAAwB,OAA5B,EAAqC;AACjC,mBAAO,yBAAP;AACH,SAFD,MAEO,IAAIzB,MAAMyB,WAAN,OAAwB,QAA5B,EAAsC;AACzC,mBAAO,0BAAP;AACH,SAFM,MAEA,IAAIzB,MAAMyB,WAAN,OAAwB,KAA5B,EAAmC;AACtC,mBAAO,wBAAP;AACH,SAFM,MAEA;AAAE,mBAAOzB,MAAMyB,WAAN,EAAP;AAA6B;AACzC,K;;AA3dMC,a;;AACCC,4B,kBAAAA,gB;;AAGDC,oB;;AACAC,oB;;;;;;;;;;;;;;;;;;;;;AAEDC,yB,GAAgB;AAClBC,+BAAe,EADG;AAElBC,iCAAiB,EAFC;AAGlBC,+BAAe,EAHG;AAIlBC,8BAAc,EAJI;AAKlBC,4BAAY,EALM;AAMlBC,wBAAQ,EANU;AAOlBC,yBAAS,EAPS;AAQlBC,yBAAS,EARS;AASlBC,wBAAQ,EATU;AAUlBC,mCAAmB,KAVD;AAWlBC,wBAAQ,OAXU;AAYlBlB,uBAAO,OAZW;AAalBmB,6BAAa,IAbK;AAclBC,iCAAiB,EAdC;AAelB;AACAC,yBAAS;AAhBS,a;AAmBlBC,4B,GAAmB,I;;qCAEVC,a;;;AAET,uCAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,IAA/B,EAAqCP,WAArC,EAAkD;AAAA;;AAAA,8IACxCK,MADwC,EAChCC,SADgC;;AAE9CtB,sBAAEwB,QAAF,CAAW,MAAKC,KAAhB,EAAuBrB,aAAvB;AACA,0BAAKY,WAAL,GAAmBA,WAAnB;AACA,0BAAKO,IAAL,GAAYA,IAAZ;AACA,0BAAKG,MAAL,CAAYC,EAAZ,CAAe,gBAAf,EAAiC,MAAKC,cAAL,CAAoBC,IAApB,OAAjC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,mBAAf,EAAoC,MAAKG,MAAL,CAAYD,IAAZ,OAApC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,eAAf,EAAgC,MAAKI,cAAL,CAAoBF,IAApB,OAAhC;AACA,0BAAKH,MAAL,CAAYC,EAAZ,CAAe,oBAAf,EAAqC,MAAKI,cAAL,CAAoBF,IAApB,OAArC;AAR8C;AASjD;;;;mDAEcG,Q,EAAU;AACrB,4BAAIC,iBAAiBD,SAASE,MAA9B;AACA,6BAAKT,KAAL,CAAWjB,YAAX,GAA0B,EAA1B;AACA,6BAAK,IAAIE,SAAS,CAAlB,EAAqBA,SAASuB,cAA9B,EAA8CvB,QAA9C,EAAwD;AACpD,iCAAKe,KAAL,CAAWjB,YAAX,CAAwB2B,IAAxB,CAA6B;AACzB9D,sCAAM2D,SAAStB,MAAT,EAAiB0B,MADE;AAEzBlE,uCAAO8D,SAAStB,MAAT,EAAiB2B,UAAjB,CAA4BL,SAAStB,MAAT,EAAiB2B,UAAjB,CAA4BH,MAA5B,GAAqC,CAAjE,EAAoE,CAApE;AAFkB,6BAA7B;AAIH;;AAED,4BAAG,CAACf,gBAAJ,EAAsB;AAClB,iCAAKmB,YAAL;AACH,yBAFD,MAEO;AACHnB,+CAAmB,KAAnB;AACH;;AAGD,6BAAKW,MAAL;AACH;;;mDAEa;AACV,6BAAKL,KAAL,CAAWP,OAAX,GAAqBqB,KAAKC,MAAL,EAArB;AACH;;;iDAEYC,K,EAAO;AAChB,6BAAKhB,KAAL,CAAWb,OAAX,CAAmB8B,MAAnB,CAA0BD,KAA1B,EAAiC,CAAjC;AACH;;;gDAEW;AACR,4BAAI,KAAKhB,KAAL,CAAWb,OAAX,CAAmBsB,MAAnB,KAA8B,CAAlC,EAAqC;AACjC,iCAAKT,KAAL,CAAWb,OAAX,CAAmBuB,IAAnB,CACI,IAAI5D,MAAJ,CAAW,GAAX,EAAgB,EAAhB,EAAoB,EAApB,EAAwB,MAAxB,EAAgC,iBAAhC,EAAmD,SAAnD,EAA8D,EAA9D,EAAkE,IAAlE,CADJ;AAGH,yBAJD,MAIO;AACH,gCAAIoE,aAAa,KAAKlB,KAAL,CAAWb,OAAX,CAAmB,KAAKa,KAAL,CAAWb,OAAX,CAAmBsB,MAAnB,GAA4B,CAA/C,CAAjB;AACA,iCAAKT,KAAL,CAAWb,OAAX,CAAmBuB,IAAnB,CACI,IAAI5D,MAAJ,CAAWoE,WAAWnE,MAAtB,EAA8B,EAA9B,EAAkC,EAAlC,EAAsCmE,WAAWhE,MAAjD,EAAyDgE,WAAW/D,OAApE,EAA6E+D,WAAWrE,KAAxF,EAA+FqE,WAAW7D,IAA1G,EAAgH,IAAhH,CADJ;AAGH;AACJ;;;iDAEY2D,K,EAAO;AAChB,4BAAIG,SAAS,KAAKnB,KAAL,CAAWb,OAAX,CAAmB6B,KAAnB,CAAb;AACA,6BAAKhB,KAAL,CAAWb,OAAX,CAAmB8B,MAAnB,CAA0BD,KAA1B,EAAiC,CAAjC;AACA,6BAAKhB,KAAL,CAAWb,OAAX,CAAmB8B,MAAnB,CAA0BD,QAAM,CAAhC,EAAkC,CAAlC,EAAoCG,MAApC;AACH;;;mDAEcH,K,EAAO;AAClB,4BAAIG,SAAS,KAAKnB,KAAL,CAAWb,OAAX,CAAmB6B,KAAnB,CAAb;AACA,6BAAKhB,KAAL,CAAWb,OAAX,CAAmB8B,MAAnB,CAA0BD,KAA1B,EAAiC,CAAjC;AACA,6BAAKhB,KAAL,CAAWb,OAAX,CAAmB8B,MAAnB,CAA0BD,QAAM,CAAhC,EAAkC,CAAlC,EAAoCG,MAApC;AACH;;;gDAEWH,K,EAAO;AACf,6BAAKhB,KAAL,CAAWZ,MAAX,CAAkB6B,MAAlB,CAAyBD,KAAzB,EAAgC,CAAhC;AACH;;;+CAEU;AACP,6BAAKhB,KAAL,CAAWZ,MAAX,CAAkBsB,IAAlB,CACI,IAAI3C,KAAJ,CAAU,GAAV,EAAe,MAAf,EAAuB,GAAvB,EAA4B,GAA5B,CADJ;AAGH;;;yDAEoB;;AAEjB,4BAAIqD,SAASC,KAAKrB,KAAL,CAAWZ,MAAX,CAAkBkC,GAAlB,CAAsB;AAAA,mCAAKC,EAAE3E,IAAP;AAAA,yBAAtB,CAAb;AACA4E,8BAAM,aAAaC,KAAKC,SAAL,CAAeN,MAAf,CAAnB;AACA,+BAAOA,MAAP;AACH;;;qDAEgB;AACb,6BAAKO,YAAL,CAAkB,QAAlB,EAA4B,oDAA5B,EAAkF,CAAlF;AACA,6BAAKA,YAAL,CAAkB,eAAlB,EAAmC,oDAAnC,EAAyF,CAAzF;AACA,6BAAKA,YAAL,CAAkB,qBAAlB,EAAyC,sDAAzC,EAAiG,CAAjG;AACH;;;yCAEIC,K,EAAOC,I,EAAMC,K,EAAOT,I,EAAM;AAC3B,4BAAMU,kBAAkBF,KAAKG,IAAL,CAAU,kBAAV,CAAxB;;AAEA,iCAASC,aAAT,CAAuBC,GAAvB,EAA4B;AACxB,mCAAOC,SAASD,IAAIE,MAAJ,CAAW,CAAX,EAAcF,IAAIzB,MAAJ,GAAa,CAA3B,CAAT,CAAP;AACH;;AAED,iCAAS4B,QAAT,CAAkBzF,IAAlB,EAAwB;AAAA;AAAA;AAAA;;AAAA;AACpB,qDAAkByE,KAAKrB,KAAL,CAAWZ,MAA7B,8HAAqC;AAAA,wCAA5BtB,KAA4B;;AACjC,wCAAGA,MAAMlB,IAAN,IAAcA,IAAjB,EAAsB;AAClB,+CAAOkB,KAAP;AACH;AACJ;AALmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAMpB,mCAAO,IAAP;AACH;;AAED,iCAASuC,MAAT,GAAkB;;AAEd,gCAAI,CAACgB,KAAKrB,KAAL,CAAWb,OAAhB,EAAyB;AACrB;AACH;;AAED,gCAAIf,QAAQ6D,cAAcF,gBAAgBO,GAAhB,CAAoB,OAApB,CAAd,CAAZ;AACA,gCAAIhD,SAAS2C,cAAcF,gBAAgBO,GAAhB,CAAoB,QAApB,CAAd,CAAb;AACA,gCAAIC,YAAYhE,EAAEiE,KAAF,CAAQnB,KAAKrB,KAAL,CAAWjB,YAAnB,EAAiC;AAAA,uCAAStC,MAAMG,IAAf;AAAA,6BAAjC,CAAhB;AACA,gCAAI6F,mBAAmBlE,EAAEiE,KAAF,CAAQnB,KAAKrB,KAAL,CAAWlB,aAAnB,EAAkC;AAAA,uCAAW4D,QAAQjG,KAAnB;AAAA,6BAAlC,CAAvB;;AATc;AAAA;AAAA;;AAAA;AAWd,sDAAmB4E,KAAKrB,KAAL,CAAWb,OAA9B,mIAAuC;AAAA,wCAA9BgC,MAA8B;;;AAEnCwB,mDAAexB,MAAf;;AAEA,wCAAIyB,QAAQC,SAASC,cAAT,CAAwB,iBAAxB,CAAZ;;AAEA,wCAAIF,SAAS,IAAb,EAAmB;AACf,4CAAIG,aAAaF,SAASC,cAAT,CAAwB,iBAAxB,EAA2CE,WAA5D;AACA7B,+CAAO9D,IAAP,GAAc0F,aAAa1B,KAAKrB,KAAL,CAAWR,eAAxB,GAA0C,IAAxD;AACH;;AAED,wCAAIyD,cAAcxE,SAAS0C,OAAOzD,WAAhB,EAA6B,EAAEwF,MAAM,OAAR,EAAiB7F,MAAM8D,OAAO9D,IAA9B,EAA7B,IAAqE,EAAvF;AACA,wCAAGgE,KAAKrB,KAAL,CAAWX,iBAAd,EAAgC;AAC5B,4CAAIvB,QAAQuE,SAASlB,OAAOrD,KAAP,CAAalB,IAAtB,CAAZ;AACA,4CAAGkB,SAAS,IAAT,IAAiBA,MAAMK,QAA1B,EAAmC;AAC/B,gDAAIgF,WAAWrC,KAAKsC,GAAL,CAAStF,MAAMM,KAAf,EAAsB6E,WAAtB,CAAf;AACAnF,kDAAMM,KAAN,GAAc+E,QAAd;AACAhC,mDAAO/C,KAAP,GAAe+E,QAAf;AACH,yCAJD,MAIK;AACDhC,mDAAOkC,UAAP,GAAoBJ,cAAc,IAAlC;AACA9B,mDAAO/C,KAAP,GAAe6E,WAAf;AACH;AACJ,qCAVD,MAUK;AACD9B,+CAAOkC,UAAP,GAAoBJ,cAAc,IAAlC;AACA9B,+CAAO/C,KAAP,GAAe6E,WAAf;AACH;AACJ;AArCa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAuCd,sDAAmB5B,KAAKrB,KAAL,CAAWb,OAA9B,mIAAuC;AAAA,wCAA9BgC,OAA8B;;AACnC,wCAAGE,KAAKrB,KAAL,CAAWX,iBAAX,IAAgCvB,MAAMK,QAAzC,EAAkD;AAC9C,4CAAIL,QAAQuE,SAASlB,QAAOrD,KAAP,CAAalB,IAAtB,CAAZ;AACA,4CAAGkB,SAAS,IAAZ,EAAiB;AACbqD,oDAAOkC,UAAP,GAAoBvF,MAAMM,KAAN,GAAc,IAAlC;AACA+C,oDAAO/C,KAAP,GAAeN,MAAMM,KAArB;AACH;AACJ;AACD+C,4CAAO7D,OAAP,GAAiB6D,QAAOnE,SAAP,GAAmBoB,KAAnB,IAA4B+C,QAAOlE,SAAP,GAAmBqC,MAAhE;AACA,wCAAG,CAAC+B,KAAKrB,KAAL,CAAWX,iBAAf,EAAiC;AAC7B8B,gDAAOmC,YAAP,GAAsBnC,QAAOlE,SAAP,CAAiBsG,QAAjB,KAA8B,IAApD;AACApC,gDAAOqC,YAAP,GAAsBrC,QAAOnE,SAAP,CAAiBuG,QAAjB,KAA8B,IAApD;AACH,qCAHD,MAGK;AACDE;AACH;AACDtC,4CAAOuC,OAAP,GAAiBvC,QAAO9D,IAAP,CAAYkG,QAAZ,KAAyB,IAA1C;AACA;;AAEA,wCAAGpC,QAAOtD,WAAV,EAAsB;AAClBsD,gDAAOwC,YAAP,GAAsB,IAAtB;AACH,qCAFD,MAEK;AACDxC,gDAAOwC,YAAP,GAAsB,KAAtB;AACH;;AAED,wCAAGxC,QAAOxD,QAAP,IAAmBiG,SAAtB,EAAiC;AAC7BzC,gDAAOvD,YAAP,GAAqByD,KAAK9B,WAAL,CAAiBsE,OAAjB,CAAyB1C,QAAOxD,QAAhC,CAArB;AACH;;AAED;AACA,wCAAImG,gBAAgBzC,KAAK9B,WAAL,CAAiBsE,OAAjB,CAAyB1C,QAAOpE,MAAhC,CAApB;;AAEA,wCAAIgH,SAASxB,UAAUuB,aAAV,CAAb;AACA,wCAAIC,WAAWH,SAAf,EAA0B;AACtBG,iDAAS,EAACnH,MAAM,OAAP,EAAgBH,OAAO,MAAvB,EAAT;AACH;;AAED,wCAAIuH,eAAevB,iBAAiBsB,OAAOtH,KAAxB,CAAnB;;AAEA,wCAAIuH,iBAAiBJ,SAArB,EAAgC;AAC5B,4CAAIK,eAAe5C,KAAKrB,KAAL,CAAWnB,eAAX,CAA2BmF,aAAatH,SAAxC,CAAnB;AACA,4CAAIuH,iBAAiBL,SAArB,EAAgC;AAC5BzC,oDAAOhE,OAAP,GAAiB8G,aAAapH,KAA9B;AACH;AACJ;;AAED;AACAsE,4CAAO3D,cAAP,GAAwB0G,QAAQ/C,QAAOjE,MAAf,EAAsB6G,OAAOtH,KAA7B,CAAxB;AACH;AAtFa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyFjB;;AAED,iCAASkG,cAAT,CAAwBxB,MAAxB,EAAgC;;AAE5BgD,mCAAOzF,QAAP,CAAgB,MAAMyC,OAAOpE,MAA7B,EAAqCqH,SAArC,CAA+C;AAC3CC,yCAAS,IADkC;AAE3CC,0CAAU;AACVC,iDAAa,kBADH;AAEVC,6CAAS,IAFC;AAGVC,iDAAa,EAAEC,KAAK,CAAP,EAAUC,MAAM,CAAhB,EAAmBC,QAAQ,CAA3B,EAA8BC,OAAO,CAArC;AAHH,iCAFiC;AAO3CC,4CAAY,IAP+B;AAQ3CC,wCAAQ,gBAAUC,KAAV,EAAiB;AACrB,wCAAIrE,SAASqE,MAAMrE,MAAnB;;AACA;AACA1C,wCAAI,CAACgH,WAAWtE,OAAOuE,YAAP,CAAoB,QAApB,CAAX,KAA6C,CAA9C,IAAmDF,MAAMG,EAF7D;AAAA,wCAGAjH,IAAI,CAAC+G,WAAWtE,OAAOuE,YAAP,CAAoB,QAApB,CAAX,KAA6C,CAA9C,IAAmDF,MAAMI,EAH7D;;AAKA;AACAzE,2CAAO0E,KAAP,CAAaC,eAAb,GACA3E,OAAO0E,KAAP,CAAaE,SAAb,GACA,eAAetH,CAAf,GAAmB,MAAnB,GAA4BC,CAA5B,GAAgC,KAFhC;;AAIA;AACAyC,2CAAO6E,YAAP,CAAoB,QAApB,EAA8BvH,CAA9B;AACA0C,2CAAO6E,YAAP,CAAoB,QAApB,EAA8BtH,CAA9B;AAEH,iCAvB0C;AAwB3CuH,uCAAO,eAAUT,KAAV,EAAiB;AACpB,wCAAIrE,SAASqE,MAAMrE,MAAnB;;AAEA,wCAAI+E,cAAc7C,SAASC,cAAT,CAAwB,iBAAxB,EAA2C6C,YAA7D;AACA,wCAAI5C,aAAaF,SAASC,cAAT,CAAwB,iBAAxB,EAA2CE,WAA5D;;AAEA,wCAAI/E,IAAI0C,OAAOuE,YAAP,CAAoB,QAApB,CAAR;AACA,wCAAIhH,IAAIyC,OAAOuE,YAAP,CAAoB,QAApB,CAAR;;AAEA;AACA,wCAAIU,cAAe3H,IAAI,GAAL,GAAY8E,UAA9B;AACA,wCAAI8C,cAAe3H,IAAI,GAAL,GAAYwH,WAA9B;;AAEA;AACA,wCAAII,OAAO3D,SAASxB,OAAO0E,KAAP,CAAaV,IAAtB,IAA8BiB,WAAzC;AACAE,2CAAOhF,KAAKiF,KAAL,CAAWD,OAAO,KAAlB,IAA2B,KAAlC;;AAEA,wCAAIE,OAAO7D,SAASxB,OAAO0E,KAAP,CAAaX,GAAtB,IAA6BmB,WAAxC;AACAG,2CAAOlF,KAAKiF,KAAL,CAAWC,OAAO,KAAlB,IAA2B,KAAlC;;AAEArF,2CAAO0E,KAAP,CAAaC,eAAb,GACA3E,OAAO0E,KAAP,CAAaE,SAAb,GACA,qBAFA;;AAIA;AACA5E,2CAAO0E,KAAP,CAAaV,IAAb,GAAoBmB,OAAO,GAA3B;AACAnF,2CAAO0E,KAAP,CAAaX,GAAb,GAAmBsB,OAAO,GAA1B;;AAEA;AACA7E,2CAAOnE,SAAP,GAAmB8I,IAAnB;AACA3E,2CAAOlE,SAAP,GAAmB+I,IAAnB;;AAEA;AACArF,2CAAO6E,YAAP,CAAoB,QAApB,EAA8B,CAA9B;AACA7E,2CAAO6E,YAAP,CAAoB,QAApB,EAA8B,CAA9B;AACH;AA3D0C,6BAA/C;AA6DH;;AAED,iCAAS/B,YAAT,GAAuB;AAAA;AAAA;AAAA;;AAAA;AACnB,sDAAkBpC,KAAKrB,KAAL,CAAWZ,MAA7B,mIAAqC;AAAA,wCAA5BtB,MAA4B;;AACjCA,2CAAMmI,OAAN,GAAgBrC,SAAhB;AACA9F,2CAAMoI,KAAN,GAActC,SAAd;AACH;AAJkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAKnB,sDAAmBvC,KAAKrB,KAAL,CAAWb,OAA9B,mIAAuC;AAAA,wCAA9BgC,MAA8B;;AACnC,wCAAIgF,eAAehF,OAAO9D,IAAP,GAAc,EAAjC;AACA,wCAAI4F,cAAc9B,OAAO/C,KAAP,GAAe,EAAjC;AACA,wCAAIN,QAAQuE,SAASlB,OAAOrD,KAAP,CAAalB,IAAtB,CAAZ;AACA,wCAAGkB,MAAME,SAAN,IAAmB,MAAtB,EAA6B;AACzB,4CAAGF,MAAMmI,OAAN,KAAkBrC,SAArB,EAA+B;AAC3B9F,kDAAMmI,OAAN,GAAgBnI,MAAMI,CAAtB;AACH;AACDiD,+CAAOmC,YAAP,GAAsBxF,MAAMmI,OAAN,GAAgB,IAAtC;AACA9E,+CAAOqC,YAAP,GAAsB1F,MAAMG,CAAN,GAAU,IAAhC;AACAH,8CAAMmI,OAAN,GAAgBnI,MAAMmI,OAAN,GAAgBE,YAAhC;AACH,qCAPD,MAOO,IAAGrI,MAAME,SAAN,IAAmB,QAAtB,EAA+B;AAClC,4CAAGF,MAAMmI,OAAN,KAAkBrC,SAArB,EAA+B;AAC3B9F,kDAAMmI,OAAN,GAAgBnI,MAAMI,CAAtB;AACH;AACDiD,+CAAOmC,YAAP,GAAsBxF,MAAMmI,OAAN,GAAgB,IAAtC;AACA,4CAAGnI,MAAMK,QAAT,EAAkB;AACdgD,mDAAOqC,YAAP,GAAuB1F,MAAMG,CAAN,GAAWH,MAAMM,KAAN,GAAY,CAAxB,GAA8B,IAApD;AACH,yCAFD,MAEK;AACD+C,mDAAOqC,YAAP,GAAuB1F,MAAMG,CAAN,GAAWkD,OAAO/C,KAAP,GAAa,CAAzB,GAA8B,IAApD;AACH;AACDN,8CAAMmI,OAAN,GAAgBnI,MAAMmI,OAAN,GAAgBE,YAAhC;AACH,qCAXM,MAWA,IAAGrI,MAAME,SAAN,IAAmB,OAAtB,EAA8B;AACjC,4CAAGF,MAAMmI,OAAN,KAAkBrC,SAArB,EAA+B;AAC3B9F,kDAAMmI,OAAN,GAAgBnI,MAAMI,CAAtB;AACH;AACDiD,+CAAOmC,YAAP,GAAsBxF,MAAMmI,OAAN,GAAgB,IAAtC;AACA,4CAAGnI,MAAMK,QAAT,EAAkB;AACdgD,mDAAOqC,YAAP,GAAuB1F,MAAMG,CAAN,GAAUH,MAAMM,KAAjB,GAA0B,IAAhD;AACH,yCAFD,MAEK;AACD+C,mDAAOqC,YAAP,GAAuB1F,MAAMG,CAAN,GAAUkD,OAAO/C,KAAlB,GAA0B,IAAhD;AACH;AACDN,8CAAMmI,OAAN,GAAgBnI,MAAMmI,OAAN,GAAgBE,YAAhC;AACH,qCAXM,MAWA,IAAGrI,MAAME,SAAN,IAAmB,KAAtB,EAA4B;AAC/B,4CAAGF,MAAMoI,KAAN,KAAgBtC,SAAnB,EAA6B;AACzB9F,kDAAMoI,KAAN,GAAcpI,MAAMG,CAApB;AACH;AACDkD,+CAAOqC,YAAP,GAAsB1F,MAAMoI,KAAN,GAAc,IAApC;AACA/E,+CAAOmC,YAAP,GAAsBxF,MAAMI,CAAN,GAAU,IAAhC;AACAJ,8CAAMoI,KAAN,GAAcpI,MAAMoI,KAAN,GAAcjD,WAA5B;AACH;AACJ;AA9CkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA+CtB;;AAED,6BAAKhD,MAAL,CAAYC,EAAZ,CAAe,QAAf,EAAyB,YAAY;AACjCG;AACAgB,iCAAK+E,kBAAL;AACH,yBAHD;AAIH;;;sDAMiB;AACd,6BAAKpG,KAAL,CAAWpB,aAAX,CAAyB8B,IAAzB,CAA8B,IAAI/D,YAAJ,CAAiB,MAAjB,EAAyB,SAAzB,CAA9B;AACA,6BAAK0J,oBAAL;AACH;;;uDAEkB/E,G,EAAK;AACpB,4BAAIN,QAAQzC,EAAE+H,OAAF,CAAU,KAAKtG,KAAL,CAAWpB,aAArB,EAAoC0C,GAApC,CAAZ;AACA,6BAAKtB,KAAL,CAAWpB,aAAX,CAAyBqC,MAAzB,CAAgCD,KAAhC,EAAuC,CAAvC;AACA,6BAAKqF,oBAAL;AACH;;;2DAEsB;AACnB,6BAAKrG,KAAL,CAAWnB,eAAX,GAA6BN,EAAEiE,KAAF,CAAQ,KAAKxC,KAAL,CAAWpB,aAAnB,EAAkC;AAAA,mCAAW8D,QAAQ9F,IAAnB;AAAA,yBAAlC,CAA7B;AACA,6BAAKyD,MAAL;AACH;;;yDAOoB;AACjB,6BAAKL,KAAL,CAAWlB,aAAX,CAAyB4B,IAAzB,CAA8B,IAAIlE,iBAAJ,CAAsB,OAAtB,EAA+B,EAA/B,CAA9B;AACH;;;0DAEqB+J,Q,EAAU;AAC5B,4BAAIvF,QAAQzC,EAAE+H,OAAF,CAAU,KAAKtG,KAAL,CAAWlB,aAArB,EAAoCyH,QAApC,CAAZ;AACA,6BAAKvG,KAAL,CAAWlB,aAAX,CAAyBmC,MAAzB,CAAgCD,KAAhC,EAAuC,CAAvC;AACA,6BAAKX,MAAL;AACH;;;kDAEa5D,K,EAAO;;AAEjB,4BAAI,CAACA,KAAL,EAAY;AAAE,mCAAOA,KAAP;AAAe;AAC7BA,gCAAQA,QAAQ,EAAhB;AACAA,gCAAQA,MAAM+J,KAAN,CAAY,GAAZ,EAAiBlF,GAAjB,CAAqB,aAAK;AAC9B,gCAAImF,EAAEC,UAAF,CAAa,MAAb,KAAwBD,EAAEE,QAAF,CAAW,GAAX,CAA5B,EAA6C;AACzC,oCAAIC,OAAOH,EAAE5C,OAAF,CAAU,KAAV,EAAiB,EAAjB,EAAqB2C,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAAX;AACA,oCAAI3J,QAAQ4J,EAAEH,OAAF,CAAU,GAAV,IAAiB,CAAC,CAAlB,uBAAuCjI,eAAeoI,EAAE5C,OAAF,CAAU,KAAV,EAAiB,EAAjB,EAAqB2C,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAAf,CAAvC,WAAgG,EAA5G;AACA,oCAAIK,cAAcJ,EAAED,KAAF,CAAQ,GAAR,EAAa/F,MAAb,GAAsB,CAAtB,GAA0B,CAAEgG,EAAE5C,OAAF,CAAU,KAAV,EAAiB,EAAjB,EAAqB2C,KAArB,CAA2B,GAA3B,EAAgC,CAAhC,CAA5B,GAAkE,CAApF;AACAC,oCAAI,oBAAgBG,IAAhB,WAAyB/J,KAAzB,aAAuCiK,MAAvC,CAA8CD,WAA9C,CAAJ;AAEH,6BAND,MAMO,IAAIJ,EAAEC,UAAF,CAAa,OAAb,KAAyBD,EAAEE,QAAF,CAAW,GAAX,CAA7B,EAA8C;AACjDF,oCAAIA,EAAEM,KAAF,CAAQ,CAAR,EAAW,CAAC,CAAZ,CAAJ;AACA,oCAAIC,SAASP,EAAE5C,OAAF,CAAU,OAAV,EAAmB,EAAnB,EAAuB2C,KAAvB,CAA6B,GAA7B,EAAkC,CAAlC,CAAb;AACA,oCAAIS,WAAWR,EAAED,KAAF,CAAQ,GAAR,EAAa/F,MAAb,GAAsB,CAAtB,GAA0BgG,EAAE5C,OAAF,CAAU,OAAV,EAAmB,EAAnB,EAAuB2C,KAAvB,CAA6B,GAA7B,EAAkC,CAAlC,CAA1B,GAAiE,MAAhF;AACA,oCAAIU,YAAYT,EAAED,KAAF,CAAQ,GAAR,EAAa/F,MAAb,GAAsB,CAAtB,GAA0BgG,EAAE5C,OAAF,CAAU,OAAV,EAAmB,EAAnB,EAAuB2C,KAAvB,CAA6B,GAA7B,EAAkC,CAAlC,CAA1B,GAAiE,MAAjF;AACA,oCAAIK,eAAcJ,EAAED,KAAF,CAAQ,GAAR,EAAa/F,MAAb,GAAsB,CAAtB,GAA0B,CAAEgG,EAAE5C,OAAF,CAAU,OAAV,EAAmB,EAAnB,EAAuB2C,KAAvB,CAA6B,GAA7B,EAAkC,CAAlC,CAA5B,GAAoE,CAAtF;AACAC,oCAAI,mBAAeQ,QAAf,oBAAoCC,SAApC,iBAAuDF,MAAvD,WAAmEF,MAAnE,CAA0ED,YAA1E,CAAJ;AACH;AACD,mCAAOJ,CAAP;AACH,yBAhBO,EAgBLU,IAhBK,CAgBA,GAhBA,CAAR;;AAkBA,+BAAO,KAAKrH,IAAL,CAAUsH,WAAV,CAAsB3K,KAAtB,CAAP;AACH;;;;cAtX8B+B,gB;;;;AA+blC;;AAEDmB,0BAAc0H,WAAd,GAA4B,aAA5B","file":"pictureit_ctrl.js","sourcesContent":["import _ from \"lodash\";\r\nimport {MetricsPanelCtrl} from \"app/plugins/sdk\";\r\nimport \"./sprintf.js\";\r\nimport \"./angular-sprintf.js\";\r\nimport getWidth from './stringwidth/strwidth.js';\r\nimport interact from './libs/interact';\r\n\r\nconst panelDefaults = {\r\n    colorMappings: [],\r\n    colorMappingMap: [],\r\n    valueMappings: [],\r\n    metricValues: [],\r\n    seriesList: [],\r\n    series: [],\r\n    bgimage: '',\r\n    sensors: [],\r\n    groups: [],\r\n    useLabelGroupings: false,\r\n    height: '400px',\r\n    width: '100px',\r\n    templateSrv: null,\r\n    sizecoefficient: 20,\r\n    //uncache is a random number added to the img url to refresh it\r\n    uncache: 0\r\n};\r\n\r\nlet isTheFirstRender = true\r\n\r\nexport class PictureItCtrl extends MetricsPanelCtrl {\r\n\r\n    constructor($scope, $injector, $sce, templateSrv) {\r\n        super($scope, $injector);\r\n        _.defaults(this.panel, panelDefaults);\r\n        this.templateSrv = templateSrv;\r\n        this.$sce = $sce;\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('panel-initialized', this.render.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n        var dataListLength = dataList.length;\r\n        this.panel.metricValues = [];\r\n        for (var series = 0; series < dataListLength; series++) {\r\n            this.panel.metricValues.push({\r\n                name: dataList[series].target,\r\n                value: dataList[series].datapoints[dataList[series].datapoints.length - 1][0]\r\n            });\r\n        }\r\n\r\n        if(!isTheFirstRender) {\r\n            this.refreshImage()\r\n        } else {\r\n            isTheFirstRender = false\r\n        }\r\n        \r\n\r\n        this.render();\r\n    }\r\n\r\n    refreshImage(){\r\n        this.panel.uncache = Math.random()\r\n    }\r\n\r\n    deleteSensor(index) {\r\n        this.panel.sensors.splice(index, 1);\r\n    }\r\n\r\n    addSensor() {\r\n        if (this.panel.sensors.length === 0) {\r\n            this.panel.sensors.push(\r\n                new Sensor('A', 50, 25, '%.2f', 'rgb(64, 64, 64)', '#ffffff', 14, true)\r\n            );\r\n        } else {\r\n            var lastSensor = this.panel.sensors[this.panel.sensors.length - 1];\r\n            this.panel.sensors.push(\r\n                new Sensor(lastSensor.metric, 50, 25, lastSensor.format, lastSensor.bgColor, lastSensor.color, lastSensor.size, true)\r\n            );\r\n        }\r\n    }\r\n\r\n    moveSensorUp(index) {\r\n        var sensor = this.panel.sensors[index]\r\n        this.panel.sensors.splice(index, 1)\r\n        this.panel.sensors.splice(index-1,0,sensor);\r\n    }\r\n\r\n    moveSensorDown(index) {\r\n        var sensor = this.panel.sensors[index]\r\n        this.panel.sensors.splice(index, 1)\r\n        this.panel.sensors.splice(index+1,0,sensor);\r\n    }\r\n\r\n    deleteGroup(index) {\r\n        this.panel.groups.splice(index, 1);\r\n    }\r\n\r\n    addGroup() {\r\n        this.panel.groups.push(\r\n            new Group('A', \"left\", 200, 200)\r\n        );\r\n    }\r\n\r\n    getAvailableGroups() {\r\n\r\n        var result = ctrl.panel.groups.map(g => g.name);\r\n        alert(\"RESULT: \" + JSON.stringify(result))\r\n        return result;\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.addEditorTab('Sensor', 'public/plugins/bessler-pictureit-panel/editor.html', 2);\r\n        this.addEditorTab('Color Mapping', 'public/plugins/bessler-pictureit-panel/colors.html', 3);\r\n        this.addEditorTab('Value Color Mapping', 'public/plugins/bessler-pictureit-panel/mappings.html', 4);\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        const $panelContainer = elem.find('.panel-container');\r\n\r\n        function pixelStrToNum(str) {\r\n            return parseInt(str.substr(0, str.length - 2));\r\n        }\r\n\r\n        function getGroup(name) {\r\n            for (let group of ctrl.panel.groups) {\r\n                if(group.name == name){\r\n                    return group;\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        function render() {\r\n\r\n            if (!ctrl.panel.sensors) {\r\n                return;\r\n            }\r\n\r\n            let width = pixelStrToNum($panelContainer.css(\"width\"));\r\n            let height = pixelStrToNum($panelContainer.css(\"height\"));\r\n            let metricMap = _.keyBy(ctrl.panel.metricValues, value => value.name);\r\n            let valueMappingsMap = _.keyBy(ctrl.panel.valueMappings, mapping => mapping.value);\r\n\r\n            for (let sensor of ctrl.panel.sensors) {\r\n\r\n                dragEventSetup(sensor);\r\n\r\n                let image = document.getElementById('pictureit-image');\r\n\r\n                if (image != null) {\r\n                    let imageWidth = document.getElementById('pictureit-image').offsetWidth;\r\n                    sensor.size = imageWidth * ctrl.panel.sizecoefficient / 1600\r\n                }\r\n\r\n                var sensorWidth = getWidth(sensor.displayName, { font: 'Arial', size: sensor.size }) + 20;\r\n                if(ctrl.panel.useLabelGroupings){\r\n                    var group = getGroup(sensor.group.name)\r\n                    if(group != null && group.sameSize){\r\n                        var newValue = Math.max(group.width, sensorWidth);\r\n                        group.width = newValue;\r\n                        sensor.width = newValue;\r\n                    }else{\r\n                        sensor.panelWidth = sensorWidth + \"px\";  \r\n                        sensor.width = sensorWidth;\r\n                    }\r\n                }else{\r\n                    sensor.panelWidth = sensorWidth + \"px\";  \r\n                    sensor.width = sensorWidth;\r\n                }\r\n            }\r\n\r\n            for (let sensor of ctrl.panel.sensors) {\r\n                if(ctrl.panel.useLabelGroupings && group.sameSize){\r\n                    var group = getGroup(sensor.group.name)\r\n                    if(group != null){\r\n                        sensor.panelWidth = group.width + \"px\";  \r\n                        sensor.width = group.width;\r\n                    }\r\n                }\r\n                sensor.visible = sensor.xlocation < width && sensor.ylocation < height;\r\n                if(!ctrl.panel.useLabelGroupings){\r\n                    sensor.ylocationStr = sensor.ylocation.toString() + \"px\";\r\n                    sensor.xlocationStr = sensor.xlocation.toString() + \"px\";\r\n                }else{\r\n                    alignSensors();\r\n                }\r\n                sensor.sizeStr = sensor.size.toString() + \"px\";\r\n                // sensor.bgColor = 'rgb(64, 64, 64)';\r\n                \r\n                if(sensor.rectangular){\r\n                    sensor.borderRadius = '5%'\r\n                }else{\r\n                    sensor.borderRadius = '50%'\r\n                }\r\n\r\n                if(sensor.link_url != undefined) {\r\n                    sensor.resolvedLink =ctrl.templateSrv.replace(sensor.link_url);\r\n                }\r\n\r\n                //We need to replace possible variables in the sensors name\r\n                var effectiveName = ctrl.templateSrv.replace(sensor.metric);\r\n\r\n                var mValue = metricMap[effectiveName];\r\n                if (mValue === undefined) {\r\n                    mValue = {name: \"dummy\", value: 'null'};\r\n                }\r\n\r\n                var valueMapping = valueMappingsMap[mValue.value];\r\n\r\n                if (valueMapping !== undefined) {\r\n                    let colorMapping = ctrl.panel.colorMappingMap[valueMapping.colorName];\r\n                    if (colorMapping !== undefined) {\r\n                        sensor.bgColor = colorMapping.color;\r\n                    }\r\n                }\r\n\r\n                //finally format the value itself\r\n                sensor.valueFormatted = sprintf(sensor.format,mValue.value);\r\n            }\r\n\r\n            \r\n        }\r\n\r\n        function dragEventSetup(sensor) {\r\n            \r\n            window.interact('#' + sensor.metric).draggable({\r\n                inertia: true,\r\n                restrict: {\r\n                restriction: \"#draggableparent\",\r\n                endOnly: true,\r\n                elementRect: { top: 0, left: 0, bottom: 1, right: 1 }\r\n                },\r\n                autoScroll: true,\r\n                onmove: function (event) {\r\n                    var target = event.target,\r\n                    // keep the dragged position in the data-x/data-y attributes\r\n                    x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,\r\n                    y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\r\n\r\n                    // translate the element\r\n                    target.style.webkitTransform =\r\n                    target.style.transform =\r\n                    'translate(' + x + 'px, ' + y + 'px)';\r\n\r\n                    // update the position attributes\r\n                    target.setAttribute('data-x', x);\r\n                    target.setAttribute('data-y', y);\r\n\r\n                },\r\n                onend: function (event) {\r\n                    var target = event.target;\r\n\r\n                    let imageHeight = document.getElementById('pictureit-image').offsetHeight;\r\n                    let imageWidth = document.getElementById('pictureit-image').offsetWidth;\r\n\r\n                    let x = target.getAttribute('data-x');\r\n                    let y = target.getAttribute('data-y')\r\n\r\n                    // get percentage of relative distance from starting point \r\n                    let xpercentage = (x * 100) / imageWidth;\r\n                    let ypercentage = (y * 100) / imageHeight;\r\n\r\n                    // browsers dont render more than 4 decimals so better cut away the others\r\n                    let newX = parseInt(target.style.left) + xpercentage;\r\n                    newX = Math.round(newX * 10000) / 10000\r\n\r\n                    let newY = parseInt(target.style.top) + ypercentage;\r\n                    newY = Math.round(newY * 10000) / 10000\r\n\r\n                    target.style.webkitTransform =\r\n                    target.style.transform =\r\n                    'translate(0px, 0px)';\r\n                    \r\n                    // manually set the new style so I don't need to render() again\r\n                    target.style.left = newX + '%'\r\n                    target.style.top = newY + '%'\r\n\r\n                    // really update the sensor values\r\n                    sensor.xlocation = newX\r\n                    sensor.ylocation = newY\r\n\r\n                    // reset the starting sensor points\r\n                    target.setAttribute('data-x', 0);\r\n                    target.setAttribute('data-y', 0);\r\n                }\r\n            });\r\n        }\r\n\r\n        function alignSensors(){\r\n            for (let group of ctrl.panel.groups) {\r\n                group.nextTop = undefined;\r\n                group.nextX = undefined;\r\n            }\r\n            for (let sensor of ctrl.panel.sensors) {\r\n                var sensorHeight = sensor.size + 30;\r\n                var sensorWidth = sensor.width + 10;\r\n                var group = getGroup(sensor.group.name)\r\n                if(group.alignment == \"left\"){\r\n                    if(group.nextTop === undefined){\r\n                        group.nextTop = group.y;\r\n                    }\r\n                    sensor.ylocationStr = group.nextTop + \"px\";\r\n                    sensor.xlocationStr = group.x + \"px\";\r\n                    group.nextTop = group.nextTop + sensorHeight;\r\n                } else if(group.alignment == \"middle\"){\r\n                    if(group.nextTop === undefined){\r\n                        group.nextTop = group.y;\r\n                    }\r\n                    sensor.ylocationStr = group.nextTop + \"px\";\r\n                    if(group.sameSize){\r\n                        sensor.xlocationStr = (group.x - (group.width/2)) + \"px\";\r\n                    }else{\r\n                        sensor.xlocationStr = (group.x - (sensor.width/2))+ \"px\";\r\n                    }\r\n                    group.nextTop = group.nextTop + sensorHeight;\r\n                } else if(group.alignment == \"right\"){\r\n                    if(group.nextTop === undefined){\r\n                        group.nextTop = group.y;\r\n                    }\r\n                    sensor.ylocationStr = group.nextTop + \"px\";\r\n                    if(group.sameSize){\r\n                        sensor.xlocationStr = (group.x - group.width) + \"px\";\r\n                    }else{\r\n                        sensor.xlocationStr = (group.x - sensor.width)+ \"px\";\r\n                    }\r\n                    group.nextTop = group.nextTop + sensorHeight;\r\n                } else if(group.alignment == \"top\"){\r\n                    if(group.nextX === undefined){\r\n                        group.nextX = group.x;\r\n                    }\r\n                    sensor.xlocationStr = group.nextX + \"px\";\r\n                    sensor.ylocationStr = group.y + \"px\";\r\n                    group.nextX = group.nextX + sensorWidth;\r\n                }    \r\n            }\r\n        }\r\n\r\n        this.events.on('render', function () {\r\n            render();\r\n            ctrl.renderingCompleted();\r\n        });\r\n    }\r\n\r\n    //------------------\r\n    // Color mapping stuff\r\n    //------------------\r\n\r\n    addColorMapping() {\r\n        this.panel.colorMappings.push(new ColorMapping('name', '#FFFFFF'));\r\n        this.refreshColorMappings();\r\n    }\r\n\r\n    removeColorMapping(map) {\r\n        var index = _.indexOf(this.panel.colorMappings, map);\r\n        this.panel.colorMappings.splice(index, 1);\r\n        this.refreshColorMappings();\r\n    }\r\n\r\n    refreshColorMappings() {\r\n        this.panel.colorMappingMap = _.keyBy(this.panel.colorMappings, mapping => mapping.name);\r\n        this.render();\r\n    }\r\n\r\n\r\n    //------------------\r\n    // Mapping stuff\r\n    //------------------\r\n\r\n    addValueMappingMap() {\r\n        this.panel.valueMappings.push(new ValueColorMapping('value', ''));\r\n    }\r\n\r\n    removeValueMappingMap(toRemove) {\r\n        var index = _.indexOf(this.panel.valueMappings, toRemove);\r\n        this.panel.valueMappings.splice(index, 1);\r\n        this.render();\r\n    }\r\n\r\n    replaceTokens(value) {\r\n\r\n        if (!value) { return value; }\r\n        value = value + \"\";\r\n        value = value.split(\" \").map(a => {\r\n            if (a.startsWith(\"_fa-\") && a.endsWith(\"_\")) {\r\n                let icon = a.replace(/\\_/g, \"\").split(\",\")[0];\r\n                let color = a.indexOf(\",\") > -1 ? ` style=\"color:${normalizeColor(a.replace(/\\_/g, \"\").split(\",\")[1])}\" ` : \"\";     \r\n                let repeatCount = a.split(\",\").length > 2 ? +(a.replace(/\\_/g, \"\").split(\",\")[2]) : 1;\r\n                a = `<i class=\"fa ${icon}\" ${color}></i> `.repeat(repeatCount);\r\n                \r\n            } else if (a.startsWith(\"_img-\") && a.endsWith(\"_\")) {\r\n                a = a.slice(0, -1);\r\n                let imgUrl = a.replace(\"_img-\", \"\").split(\",\")[0];\r\n                let imgWidth = a.split(\",\").length > 1 ? a.replace(\"_img-\", \"\").split(\",\")[1] : \"20px\";\r\n                let imgHeight = a.split(\",\").length > 2 ? a.replace(\"_img-\", \"\").split(\",\")[2] : \"20px\";\r\n                let repeatCount = a.split(\",\").length > 3 ? +(a.replace(\"_img-\", \"\").split(\",\")[3]) : 1;\r\n                a = `<img width=\"${imgWidth}\" height=\"${imgHeight}\" src=\"${imgUrl}\"/>`.repeat(repeatCount);\r\n            }\r\n            return a;\r\n        }).join(\" \");\r\n\r\n        return this.$sce.trustAsHtml(value);\r\n    }\r\n\r\n    /* addRangeMappingMap() {\r\n     this.panel.rangeMappingMap.push({from: '', to: '', text: ''});\r\n     }\r\n\r\n     removeRangeMappingMap(rangeMap) {\r\n     var index = _.indexOf(this.panel.rangeMaps, rangeMap);\r\n     this.panel.rangeMappingMap.splice(index, 1);\r\n     this.render();\r\n     };*/\r\n}\r\n\r\nfunction ValueColorMapping(value,\r\n                           colorName) {\r\n    'use strict';\r\n    this.value = value;\r\n    this.colorName = colorName;\r\n}\r\n\r\n\r\nfunction ColorMapping(name, color) {\r\n    'use strict';\r\n    this.name = name;\r\n    this.color = color;\r\n}\r\n\r\nfunction Sensor(metric,\r\n                xlocation,\r\n                ylocation,\r\n                format,\r\n                bgColor,\r\n                fontColor,\r\n                size,\r\n                visible) {\r\n    'use strict';\r\n    this.metric = metric;\r\n    this.xlocation = xlocation;\r\n    this.ylocation = ylocation;\r\n    this.format = format;\r\n    this.bgColor = bgColor;\r\n    this.fontColor = fontColor;\r\n    this.size = size;\r\n    this.visible = visible;\r\n    this.renderValue = false;\r\n    this.valueFormatted = '';\r\n    this.valueUnit = '';\r\n    this.displayName = '';\r\n    this.link_url = '';\r\n    this.resolvedLink = '';\r\n    this.rectangular = true;\r\n    this.group = 'A';\r\n}\r\n\r\nfunction Group(name, alignment, x, y) {\r\n    'use strict';\r\n    this.name = name;\r\n    this.alignment = alignment;\r\n    this.x = x;\r\n    this.y = y;\r\n    this.sameSize = false;\r\n    this.width = 100;\r\n}\r\n\r\nfunction normalizeColor(color) {\r\n    \r\n    if (color.toLowerCase() === \"green\") {\r\n        return \"rgba(50, 172, 45, 0.97)\";\r\n    } else if (color.toLowerCase() === \"orange\") {\r\n        return \"rgba(237, 129, 40, 0.89)\";\r\n    } else if (color.toLowerCase() === \"red\") {\r\n        return \"rgba(245, 54, 54, 0.9)\";\r\n    } else { return color.toLowerCase(); }\r\n};\r\n\r\nPictureItCtrl.templateUrl = 'module.html';\r\n"]}