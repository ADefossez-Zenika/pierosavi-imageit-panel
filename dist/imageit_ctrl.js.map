{"version":3,"sources":["../src/imageit_ctrl.js"],"names":["getRandomId","Math","random","toString","substr","ValueColorMapping","value","colorName","ColorMapping","name","color","Sensor","metric","xlocation","ylocation","format","bgColor","fontColor","size","visible","renderValue","valueFormatted","valueUnit","displayName","link_url","resolvedLink","rectangular","group","id","Group","alignment","x","y","sameSize","width","normalizeColor","toLowerCase","_","MetricsPanelCtrl","getWidth","interact","panelDefaults","colorMappings","colorMappingMap","valueMappings","metricValues","seriesList","series","bgimage","sensors","groups","useLabelGroupings","height","templateSrv","sizecoefficient","uncache","isTheFirstRender","ImageItCtrl","$scope","$injector","$sce","defaults","panel","events","on","onInitEditMode","bind","render","onDataReceived","dataList","dataListLength","length","push","target","datapoints","refreshImage","index","splice","sensor","result","ctrl","map","g","alert","JSON","stringify","addEditorTab","scope","elem","attrs","panelContainer","find","image","querySelector","getGroup","metricMap","keyBy","valueMappingsMap","mapping","hasOwnProperty","imageWidth","offsetWidth","sensorWidth","font","newValue","max","panelWidth","ylocationStr","xlocationStr","alignSensors","sizeStr","borderRadius","undefined","replace","effectiveName","mValue","valueMapping","colorMapping","realBgColor","sprintf","dragEventSetup","window","draggable","inertia","restrict","restriction","endOnly","elementRect","top","left","bottom","right","autoScroll","onmove","event","parseFloat","getAttribute","dx","dy","style","webkitTransform","transform","setAttribute","onend","imageHeight","offsetHeight","xpercentage","ypercentage","newX","parseInt","round","newY","nextTop","nextX","sensorHeight","renderingCompleted","refreshColorMappings","indexOf","toRemove","split","a","startsWith","endsWith","icon","repeatCount","repeat","slice","imgUrl","imgWidth","imgHeight","join","trustAsHtml","templateUrl"],"mappings":"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","sourcesContent":["import _ from \"lodash\";\r\nimport {MetricsPanelCtrl} from \"app/plugins/sdk\";\r\nimport \"./sprintf.js\";\r\nimport \"./angular-sprintf.js\";\r\nimport getWidth from './stringwidth/strwidth.js';\r\nimport interact from './libs/interact';\r\n\r\nconst panelDefaults = {\r\n    colorMappings: [],\r\n    colorMappingMap: [],\r\n    valueMappings: [],\r\n    metricValues: [],\r\n    seriesList: [],\r\n    series: [],\r\n    bgimage: '',\r\n    sensors: [],\r\n    groups: [],\r\n    useLabelGroupings: false,\r\n    height: '400px',\r\n    width: '100px',\r\n    templateSrv: null,\r\n    sizecoefficient: 20,\r\n    //uncache is a random number added to the img url to refresh it\r\n    uncache: 0\r\n};\r\n\r\nlet isTheFirstRender = true\r\n\r\nexport class ImageItCtrl extends MetricsPanelCtrl {\r\n\r\n    constructor($scope, $injector, $sce, templateSrv) {\r\n        super($scope, $injector);\r\n        _.defaults(this.panel, panelDefaults);\r\n        this.templateSrv = templateSrv;\r\n        this.$sce = $sce;\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('panel-initialized', this.render.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n        const dataListLength = dataList.length;\r\n        this.panel.metricValues = [];\r\n        for (let series = 0; series < dataListLength; series++) {\r\n            this.panel.metricValues.push({\r\n                name: dataList[series].target,\r\n                value: dataList[series].datapoints[dataList[series].datapoints.length - 1][0]\r\n            });\r\n        }\r\n\r\n        if(!isTheFirstRender) {\r\n            this.refreshImage()\r\n        } else {\r\n            isTheFirstRender = false\r\n        }\r\n        \r\n\r\n        this.render();\r\n    }\r\n\r\n    refreshImage(){\r\n        this.panel.uncache = Math.random()\r\n    }\r\n\r\n    deleteSensor(index) {\r\n        this.panel.sensors.splice(index, 1);\r\n    }\r\n\r\n    addSensor() {\r\n        this.panel.sensors.push(\r\n            new Sensor('A', 50, 25, '%.2f', 'rgba(64,64,64,1.000)', 'rgba(255,255,255,1.000)', 14, true)\r\n        );\r\n    }\r\n\r\n    moveSensorUp(index) {\r\n        const sensor = this.panel.sensors[index]\r\n        this.panel.sensors.splice(index, 1)\r\n        this.panel.sensors.splice(index-1,0,sensor);\r\n    }\r\n\r\n    moveSensorDown(index) {\r\n        const sensor = this.panel.sensors[index]\r\n        this.panel.sensors.splice(index, 1)\r\n        this.panel.sensors.splice(index+1,0,sensor);\r\n    }\r\n\r\n    deleteGroup(index) {\r\n        this.panel.groups.splice(index, 1);\r\n    }\r\n\r\n    addGroup() {\r\n        this.panel.groups.push(\r\n            new Group('A', \"left\", 50, 50)\r\n        );\r\n    }\r\n\r\n    getAvailableGroups() {\r\n\r\n        const result = ctrl.panel.groups.map(g => g.name);\r\n        alert(\"RESULT: \" + JSON.stringify(result))\r\n        return result;\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.addEditorTab('Sensor', 'public/plugins/pierosavi-imageit-panel/editor.html', 2);\r\n        this.addEditorTab('Color Mapping', 'public/plugins/pierosavi-imageit-panel/colors.html', 3);\r\n        this.addEditorTab('Value Mapping', 'public/plugins/pierosavi-imageit-panel/mappings.html', 4);\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        const panelContainer = (elem.find('.pierosavi-imageit-panel')[0]);\r\n        const image = (panelContainer.querySelector('#imageit-image'))\r\n\r\n        function getGroup(name) {\r\n            for (let group of ctrl.panel.groups) {\r\n                if(group.name == name){\r\n                    return group;\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n        function render() {\r\n\r\n            if (!ctrl.panel.sensors) {\r\n                return;\r\n            }\r\n\r\n            let metricMap = _.keyBy(ctrl.panel.metricValues, value => value.name);\r\n            let valueMappingsMap = _.keyBy(ctrl.panel.valueMappings, mapping => mapping.value);\r\n\r\n            for (let sensor of ctrl.panel.sensors) {\r\n\r\n                if(!sensor.hasOwnProperty('id')){\r\n                    sensor.id = getRandomId()\r\n                }\r\n\r\n                if (image != null) {\r\n                    let imageWidth = image.offsetWidth;\r\n                    sensor.size = imageWidth * ctrl.panel.sizecoefficient / 1600\r\n                }\r\n\r\n                const sensorWidth = getWidth(sensor.displayName, { font: 'Arial', size: sensor.size }) + 20;\r\n                if(ctrl.panel.useLabelGroupings){\r\n                    const group = getGroup(sensor.group.name)\r\n                    if(group != null && group.sameSize){\r\n                        const newValue = Math.max(group.width, sensorWidth);\r\n                        group.width = newValue;\r\n                        sensor.width = newValue;\r\n                    }else{\r\n                        sensor.panelWidth = sensorWidth + \"px\";  \r\n                        sensor.width = sensorWidth;\r\n                    }\r\n                }else{\r\n                    sensor.panelWidth = sensorWidth + \"px\";  \r\n                    sensor.width = sensorWidth;\r\n                }\r\n            }\r\n\r\n            for (let sensor of ctrl.panel.sensors) {\r\n                if(ctrl.panel.useLabelGroupings && group.sameSize){\r\n                    const group = getGroup(sensor.group.name)\r\n                    if(group != null){\r\n                        sensor.panelWidth = group.width + \"px\";  \r\n                        sensor.width = group.width;\r\n                    }\r\n                }\r\n\r\n                if(!ctrl.panel.useLabelGroupings){\r\n                    sensor.ylocationStr = sensor.ylocation.toString() + \"px\";\r\n                    sensor.xlocationStr = sensor.xlocation.toString() + \"px\";\r\n                }else{\r\n                    alignSensors();\r\n                }\r\n                sensor.sizeStr = sensor.size.toString() + \"px\";\r\n                \r\n                if(sensor.rectangular){\r\n                    sensor.borderRadius = '5%'\r\n                }else{\r\n                    sensor.borderRadius = '50%'\r\n                }\r\n\r\n                if(sensor.link_url != undefined) {\r\n                    sensor.resolvedLink =ctrl.templateSrv.replace(sensor.link_url);\r\n                }\r\n\r\n                //We need to replace possible variables in the sensors name\r\n                const effectiveName = ctrl.templateSrv.replace(sensor.metric);\r\n\r\n                let mValue = metricMap[effectiveName];\r\n                if (mValue === undefined) {\r\n                    mValue = {name: \"dummy\", value: 'null'};\r\n                }\r\n                \r\n                let valueMapping = valueMappingsMap[mValue.value];\r\n\r\n                if (valueMapping !== undefined) {\r\n                    let colorMapping = ctrl.panel.colorMappingMap[valueMapping.colorName];\r\n                    if (colorMapping !== undefined) {\r\n                        sensor.realBgColor = colorMapping.color;\r\n                    }\r\n                } else {\r\n                    // new sensor property so it doesn't lose the original one \r\n                    // https://github.com/pierosavi/pierosavi-imageit-panel/issues/4\r\n                    sensor.realBgColor = sensor.bgColor\r\n                }\r\n\r\n                //finally format the value itself\r\n                sensor.valueFormatted = sprintf(sensor.format,mValue.value);\r\n            }\r\n\r\n            dragEventSetup();\r\n            \r\n        }\r\n\r\n        function dragEventSetup() {\r\n            window.interact('#imageit_panel' + ctrl.panel.id + '_sensor').draggable({\r\n                // I dont like it personally but this could be configurable in the future\r\n                inertia: false,\r\n                restrict: {\r\n                    restriction: \"#draggableparent\",\r\n                    endOnly: true,\r\n                    elementRect: { top: 0, left: 0, bottom: 1, right: 1 }\r\n                },\r\n                autoScroll: true,\r\n                onmove: function (event) {\r\n                    const target = event.target,\r\n                    // keep the dragged position in the data-x/data-y attributes\r\n                    x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,\r\n                    y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\r\n\r\n                    // translate the element\r\n                    target.style.webkitTransform =\r\n                    target.style.transform =\r\n                    'translate(' + x + 'px, ' + y + 'px)';\r\n\r\n                    // update the position attributes\r\n                    target.setAttribute('data-x', x);\r\n                    target.setAttribute('data-y', y);\r\n\r\n                },\r\n                onend: function (event) {\r\n                    const target = event.target;\r\n\r\n                    let imageHeight = image.offsetHeight;\r\n                    let imageWidth = image.offsetWidth;\r\n\r\n                    let x = target.getAttribute('data-x');\r\n                    let y = target.getAttribute('data-y')\r\n\r\n                    // get percentage of relative distance from starting point \r\n                    let xpercentage = (x * 100) / imageWidth;\r\n                    let ypercentage = (y * 100) / imageHeight;\r\n\r\n                    // browsers dont render more than 4 decimals so better cut away the others\r\n                    let newX = parseInt(target.style.left) + xpercentage;\r\n                    newX = Math.round(newX * 10000) / 10000\r\n\r\n                    let newY = parseInt(target.style.top) + ypercentage;\r\n                    newY = Math.round(newY * 10000) / 10000\r\n\r\n                    target.style.webkitTransform =\r\n                    target.style.transform =\r\n                    'translate(0px, 0px)';\r\n                    \r\n                    // manually set the new style so I don't need to render() again\r\n                    target.style.left = newX + '%'\r\n                    target.style.top = newY + '%'\r\n\r\n                    // really update the sensor values\r\n\r\n                    //find sensor with the id from the refId attribute on html\r\n                    let sensor = _.find(ctrl.panel.sensors, {'id': (event.target).getAttribute('refId')})\r\n\r\n                    sensor.xlocation = newX\r\n                    sensor.ylocation = newY\r\n\r\n                    // reset the starting sensor points\r\n                    target.setAttribute('data-x', 0);\r\n                    target.setAttribute('data-y', 0);\r\n                }\r\n            });\r\n        }\r\n\r\n        function alignSensors(){\r\n            for (let group of ctrl.panel.groups) {\r\n                group.nextTop = undefined;\r\n                group.nextX = undefined;\r\n            }\r\n            for (let sensor of ctrl.panel.sensors) {\r\n                const sensorHeight = sensor.size + 30;\r\n                const sensorWidth = sensor.width + 10;\r\n                let group = getGroup(sensor.group.name)\r\n                if(group.alignment == \"left\"){\r\n                    if(group.nextTop === undefined){\r\n                        group.nextTop = group.y;\r\n                    }\r\n                    sensor.ylocationStr = group.nextTop + \"px\";\r\n                    sensor.xlocationStr = group.x + \"px\";\r\n                    group.nextTop = group.nextTop + sensorHeight;\r\n                } else if(group.alignment == \"middle\"){\r\n                    if(group.nextTop === undefined){\r\n                        group.nextTop = group.y;\r\n                    }\r\n                    sensor.ylocationStr = group.nextTop + \"px\";\r\n                    if(group.sameSize){\r\n                        sensor.xlocationStr = (group.x - (group.width/2)) + \"px\";\r\n                    }else{\r\n                        sensor.xlocationStr = (group.x - (sensor.width/2))+ \"px\";\r\n                    }\r\n                    group.nextTop = group.nextTop + sensorHeight;\r\n                } else if(group.alignment == \"right\"){\r\n                    if(group.nextTop === undefined){\r\n                        group.nextTop = group.y;\r\n                    }\r\n                    sensor.ylocationStr = group.nextTop + \"px\";\r\n                    if(group.sameSize){\r\n                        sensor.xlocationStr = (group.x - group.width) + \"px\";\r\n                    }else{\r\n                        sensor.xlocationStr = (group.x - sensor.width)+ \"px\";\r\n                    }\r\n                    group.nextTop = group.nextTop + sensorHeight;\r\n                } else if(group.alignment == \"top\"){\r\n                    if(group.nextX === undefined){\r\n                        group.nextX = group.x;\r\n                    }\r\n                    sensor.xlocationStr = group.nextX + \"px\";\r\n                    sensor.ylocationStr = group.y + \"px\";\r\n                    group.nextX = group.nextX + sensorWidth;\r\n                }    \r\n            }\r\n        }\r\n\r\n        this.events.on('render', function () {\r\n            render();\r\n            ctrl.renderingCompleted();\r\n        });\r\n    }\r\n\r\n    //------------------\r\n    // Color mapping stuff\r\n    //------------------\r\n\r\n    addColorMapping() {\r\n        this.panel.colorMappings.push(new ColorMapping('name', '#FFFFFF'));\r\n        this.refreshColorMappings();\r\n    }\r\n\r\n    removeColorMapping(map) {\r\n        const index = _.indexOf(this.panel.colorMappings, map);\r\n        this.panel.colorMappings.splice(index, 1);\r\n        this.refreshColorMappings();\r\n    }\r\n\r\n    refreshColorMappings() {\r\n        this.panel.colorMappingMap = _.keyBy(this.panel.colorMappings, mapping => mapping.name);\r\n        this.render();\r\n    }\r\n\r\n\r\n    //------------------\r\n    // Mapping stuff\r\n    //------------------\r\n\r\n    addValueMappingMap() {\r\n        this.panel.valueMappings.push(new ValueColorMapping('value', ''));\r\n    }\r\n\r\n    removeValueMappingMap(toRemove) {\r\n        const index = _.indexOf(this.panel.valueMappings, toRemove);\r\n        this.panel.valueMappings.splice(index, 1);\r\n        this.render();\r\n    }\r\n\r\n    replaceTokens(value) {\r\n\r\n        if (!value) { return value; }\r\n        value = value + \"\";\r\n        value = value.split(\" \").map(a => {\r\n            if (a.startsWith(\"_fa-\") && a.endsWith(\"_\")) {\r\n                let icon = a.replace(/\\_/g, \"\").split(\",\")[0];\r\n                let color = a.indexOf(\",\") > -1 ? ` style=\"color:${normalizeColor(a.replace(/\\_/g, \"\").split(\",\")[1])}\" ` : \"\";     \r\n                let repeatCount = a.split(\",\").length > 2 ? +(a.replace(/\\_/g, \"\").split(\",\")[2]) : 1;\r\n                a = `<i class=\"fa ${icon}\" ${color}></i> `.repeat(repeatCount);\r\n                \r\n            } else if (a.startsWith(\"_img-\") && a.endsWith(\"_\")) {\r\n                a = a.slice(0, -1);\r\n                let imgUrl = a.replace(\"_img-\", \"\").split(\",\")[0];\r\n                let imgWidth = a.split(\",\").length > 1 ? a.replace(\"_img-\", \"\").split(\",\")[1] : \"20px\";\r\n                let imgHeight = a.split(\",\").length > 2 ? a.replace(\"_img-\", \"\").split(\",\")[2] : \"20px\";\r\n                let repeatCount = a.split(\",\").length > 3 ? +(a.replace(\"_img-\", \"\").split(\",\")[3]) : 1;\r\n                a = `<img width=\"${imgWidth}\" height=\"${imgHeight}\" src=\"${imgUrl}\"/>`.repeat(repeatCount);\r\n            }\r\n            return a;\r\n        }).join(\" \");\r\n\r\n        return this.$sce.trustAsHtml(value);\r\n    }\r\n\r\n    /* addRangeMappingMap() {\r\n     this.panel.rangeMappingMap.push({from: '', to: '', text: ''});\r\n     }\r\n\r\n     removeRangeMappingMap(rangeMap) {\r\n     var index = _.indexOf(this.panel.rangeMaps, rangeMap);\r\n     this.panel.rangeMappingMap.splice(index, 1);\r\n     this.render();\r\n     };*/\r\n}\r\n\r\nfunction getRandomId() {\r\n    return '_' + Math.random().toString(36).substr(2, 9);\r\n};\r\n\r\nfunction ValueColorMapping(value,\r\n                           colorName) {\r\n    'use strict';\r\n    this.value = value;\r\n    this.colorName = colorName;\r\n}\r\n\r\n\r\nfunction ColorMapping(name, color) {\r\n    'use strict';\r\n    this.name = name;\r\n    this.color = color;\r\n}\r\n\r\nfunction Sensor(metric,\r\n                xlocation,\r\n                ylocation,\r\n                format,\r\n                bgColor,\r\n                fontColor,\r\n                size,\r\n                visible) {\r\n    'use strict';\r\n    this.metric = metric;\r\n    this.xlocation = xlocation;\r\n    this.ylocation = ylocation;\r\n    this.format = format;\r\n    this.bgColor = bgColor;\r\n    this.fontColor = fontColor;\r\n    this.size = size;\r\n    this.visible = visible;\r\n    this.renderValue = false;\r\n    this.valueFormatted = '';\r\n    this.valueUnit = '';\r\n    this.displayName = '';\r\n    this.link_url = '';\r\n    this.resolvedLink = '';\r\n    this.rectangular = true;\r\n    this.group = 'A';\r\n    this.id = getRandomId()\r\n}\r\n\r\nfunction Group(name, alignment, x, y) {\r\n    'use strict';\r\n    this.name = name;\r\n    this.alignment = alignment;\r\n    this.x = x;\r\n    this.y = y;\r\n    this.sameSize = false;\r\n    this.width = 100;\r\n}\r\n\r\nfunction normalizeColor(color) {\r\n    \r\n    if (color.toLowerCase() === \"green\") {\r\n        return \"rgba(50, 172, 45, 0.97)\";\r\n    } else if (color.toLowerCase() === \"orange\") {\r\n        return \"rgba(237, 129, 40, 0.89)\";\r\n    } else if (color.toLowerCase() === \"red\") {\r\n        return \"rgba(245, 54, 54, 0.9)\";\r\n    } else { return color.toLowerCase(); }\r\n};\r\n\r\nImageItCtrl.templateUrl = 'module.html';\r\n"],"file":"imageit_ctrl.js"}