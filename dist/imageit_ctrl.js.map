<<<<<<< HEAD
{"version":3,"sources":["../src/imageit_ctrl.js"],"names":["isEqualTo","a","b","undefined","isGreaterThan","isLessThan","getMappingOperators","mappingOperators","getRandomId","Math","random","toString","substr","ValueColorMapping","id","name","operatorName","compareTo","isSensorFontBold","fontColor","bgColor","nameBlink","valueBlink","bgBlink","Sensor","metric","xlocation","ylocation","size","visible","renderValue","valueFormatted","valueUnit","displayName","link_url","resolvedLink","rectangular","valueMappingIds","isBold","unitFormat","decimals","setUnitFormat","subItem","value","normalizeColor","color","toLowerCase","_","MetricsPanelCtrl","getWidth","kbn","getValueFormat","panelDefaults","colorMappings","colorMappingMap","valueMappings","metricValues","seriesList","series","bgimage","sensors","templateSrv","sizecoefficient","uncache","islocked","operator","fn","isTheFirstRender","ImageItCtrl","$scope","$injector","$sce","defaults","panel","events","on","onInitEditMode","bind","render","onDataReceived","dataList","dataListLength","length","push","target","datapoints","refreshImage","index","splice","sensor","addEditorTab","unitFormats","getUnitFormats","scope","elem","attrs","ctrl","panelContainer","find","image","querySelector","draggableElement","imageWidth","offsetWidth","imageHeight","offsetHeight","metricMap","keyBy","valueMappingsMap","mapping","mappingOperatorsMap","sizeCoefficient","sensorWidth","font","width","xlocationStr","ylocationStr","borderRadius","replace","effectiveName","mValue","valueMapping","mappingOperatorName","mappingId","mappingOperator","realFontColor","realBgColor","normalizeSensor","formatFunc","dragEventSetup","window","interact","isSet","unset","draggable","inertia","restrict","restriction","endOnly","elementRect","top","left","bottom","right","autoScroll","onmove","event","datax","parseFloat","getAttribute","dx","datay","dy","elementTransform","style","webkitTransform","transform","setAttribute","onend","xpercentage","ypercentage","renderingCompleted","originalValue","split","map","startsWith","endsWith","icon","indexOf","repeatCount","repeat","slice","imgUrl","imgWidth","imgHeight","join","trustAsHtml","templateUrl"],"mappings":"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","sourcesContent":["/* eslint-disable class-methods-use-this */\r\n/* eslint-disable func-names */\r\n/* eslint-disable no-restricted-syntax */\r\n/* eslint-disable import/prefer-default-export */\r\nimport _ from 'lodash';\r\nimport {\r\n    MetricsPanelCtrl\r\n} from 'app/plugins/sdk';\r\nimport getWidth from './stringwidth/strwidth';\r\nimport './libs/interact';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport { getValueFormat } from '@grafana/ui';\r\n\r\nconst panelDefaults = {\r\n    colorMappings: [],\r\n    colorMappingMap: [],\r\n    valueMappings: [],\r\n    metricValues: [],\r\n    seriesList: [],\r\n    series: [],\r\n    bgimage: '',\r\n    sensors: [],\r\n    templateSrv: null,\r\n    sizecoefficient: 20,\r\n    // uncache is a random number added to the img url to refresh it\r\n    uncache: 0,\r\n    islocked: false\r\n};\r\n\r\nconst mappingOperators = [{\r\n    name: 'equal',\r\n    operator: '=',\r\n    fn: isEqualTo\r\n}, {\r\n    name: 'greaterThan',\r\n    operator: '>',\r\n    fn: isGreaterThan\r\n}, {\r\n    name: 'lessThan',\r\n    operator: '<',\r\n    fn: isLessThan\r\n}];\r\n\r\nlet isTheFirstRender = true;\r\n\r\nexport class ImageItCtrl extends MetricsPanelCtrl {\r\n    constructor($scope, $injector, $sce, templateSrv) {\r\n        super($scope, $injector);\r\n        _.defaults(this.panel, panelDefaults);\r\n        this.templateSrv = templateSrv;\r\n        this.$sce = $sce;\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('panel-initialized', this.render.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n        const dataListLength = dataList.length;\r\n        this.panel.metricValues = [];\r\n        for (let series = 0; series < dataListLength; series += 1) {\r\n            this.panel.metricValues.push({\r\n                name: dataList[series].target,\r\n                value: dataList[series].datapoints[dataList[series].datapoints.length - 1][0]\r\n            });\r\n        }\r\n\r\n        if (!isTheFirstRender) {\r\n            this.refreshImage();\r\n        } else {\r\n            isTheFirstRender = false;\r\n        }\r\n\r\n\r\n        this.render();\r\n    }\r\n\r\n    refreshImage() {\r\n        this.panel.uncache = Math.random();\r\n    }\r\n\r\n    deleteSensor(index) {\r\n        this.panel.sensors.splice(index, 1);\r\n    }\r\n\r\n    addSensor() {\r\n        this.panel.sensors.push(\r\n            new Sensor()\r\n        );\r\n    }\r\n\r\n    moveSensorUp(index) {\r\n        const sensor = this.panel.sensors[index];\r\n        this.panel.sensors.splice(index, 1);\r\n        this.panel.sensors.splice(index - 1, 0, sensor);\r\n    }\r\n\r\n    moveSensorDown(index) {\r\n        const sensor = this.panel.sensors[index];\r\n        this.panel.sensors.splice(index, 1);\r\n        this.panel.sensors.splice(index + 1, 0, sensor);\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.addEditorTab('Sensor', 'public/plugins/pierosavi-imageit-panel/editor.html', 2);\r\n        this.addEditorTab('Value Mapping', 'public/plugins/pierosavi-imageit-panel/mappings.html', 3);\r\n        this.unitFormats = kbn.getUnitFormats();\r\n    }\r\n\r\n    toggleBlock() {\r\n        this.panel.islocked = !this.panel.islocked;\r\n        this.render();\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        const panelContainer = (elem.find('.pierosavi-imageit-panel')[0]);\r\n        const image = (panelContainer.querySelector('#imageit-image'));\r\n        const draggableElement = '#imageit_panel' + ctrl.panel.id + '_sensor';\r\n\r\n        function render() {\r\n            if (!ctrl.panel.sensors || (ctrl.panel.bgimage === '')) {\r\n                return;\r\n            }\r\n\r\n            const imageWidth = image.offsetWidth;\r\n            const imageHeight = image.offsetHeight;\r\n\r\n            const metricMap = _.keyBy(ctrl.panel.metricValues, value => value.name);\r\n            const valueMappingsMap = _.keyBy(ctrl.panel.valueMappings, mapping => mapping.id);\r\n            const mappingOperatorsMap = _.keyBy(mappingOperators, operator => operator.name);\r\n\r\n            for (const sensor of ctrl.panel.sensors) {\r\n                _.defaults(sensor, new Sensor());\r\n\r\n                const sizeCoefficient = sensor.sizeCoefficient ? sensor.sizeCoefficient : ctrl.panel.sizecoefficient;\r\n\r\n                sensor.size = imageWidth * sizeCoefficient / 1600;\r\n                const sensorWidth = getWidth(sensor.displayName, {\r\n                    font: 'Arial',\r\n                    size: sensor.size\r\n                }) + 20;\r\n\r\n                sensor.width = sensorWidth;\r\n\r\n                sensor.xlocationStr = (sensor.xlocation * imageWidth / 100) + 'px';\r\n                sensor.ylocationStr = (sensor.ylocation * imageHeight / 100) + 'px';\r\n\r\n                sensor.borderRadius = sensor.rectangular ? '5%' : '50%';\r\n\r\n                if (sensor.link_url !== undefined) {\r\n                    sensor.resolvedLink = ctrl.templateSrv.replace(sensor.link_url);\r\n                }\r\n\r\n                // We need to replace possible variables in the sensors name\r\n                const effectiveName = ctrl.templateSrv.replace(sensor.metric);\r\n\r\n                const mValue = metricMap[effectiveName];\r\n\r\n                // update existing valueMappings\r\n                for (const valueMapping of ctrl.panel.valueMappings) {\r\n                    if (valueMapping.mappingOperatorName == null) {\r\n                        valueMapping.mappingOperatorName = mappingOperators[0].name;\r\n                    }\r\n\r\n                    if (valueMapping.id == null) {\r\n                        valueMapping.id = getRandomId();\r\n                    }\r\n                }\r\n\r\n                if (sensor.valueMappingIds === undefined) {\r\n                    sensor.valueMappingIds = [];\r\n                }\r\n\r\n                if (sensor.valueMappingIds.length > 0) {\r\n                    for (const mappingId of sensor.valueMappingIds) {\r\n                        const valueMapping = valueMappingsMap[mappingId];\r\n\r\n                        if (valueMapping === undefined) {\r\n                            break;\r\n                        }\r\n\r\n                        const mappingOperator = mappingOperatorsMap[valueMapping.mappingOperatorName];\r\n\r\n                        if (mappingOperator.fn(mValue.value, valueMapping.compareTo)) {\r\n                            sensor.realFontColor = valueMapping.fontColor;\r\n                            sensor.realBgColor = valueMapping.bgColor;\r\n\r\n                            sensor.nameBlink = valueMapping.nameBlink;\r\n                            sensor.valueBlink = valueMapping.valueBlink;\r\n                            sensor.bgBlink = valueMapping.bgBlink;\r\n\r\n                            sensor.isBold = valueMapping.isSensorFontBold;\r\n\r\n                            break;\r\n                        } else {\r\n                            normalizeSensor(sensor);\r\n                        }\r\n                    }\r\n                } else {\r\n                    normalizeSensor(sensor);\r\n                }\r\n\r\n                const formatFunc = getValueFormat(sensor.unitFormat);\r\n\r\n                sensor.valueFormatted = formatFunc(mValue.value, sensor.decimals);\r\n            }\r\n\r\n            dragEventSetup();\r\n        }\r\n\r\n        function normalizeSensor(sensor) {\r\n            // new sensor property so it doesn't lose the original one\r\n            // https://github.com/pierosavi/pierosavi-imageit-panel/issues/4\r\n            sensor.realBgColor = sensor.bgColor;\r\n            sensor.realFontColor = sensor.fontColor;\r\n\r\n            sensor.nameBlink = false;\r\n            sensor.valueBlink = false;\r\n            sensor.bgBlink = false;\r\n\r\n            sensor.isBold = false;\r\n        }\r\n\r\n        function dragEventSetup() {\r\n            if (ctrl.panel.islocked) {\r\n                if (window.interact.isSet(draggableElement)) {\r\n                    window.interact(draggableElement).unset();\r\n                }\r\n            } else if (!window.interact.isSet(draggableElement)) {\r\n                window.interact(draggableElement).draggable({\r\n                    // I dont like it personally but this could be configurable in the future\r\n                    inertia: false,\r\n                    restrict: {\r\n                        restriction: '#draggableparent',\r\n                        endOnly: true,\r\n                        elementRect: {\r\n                            top: 0,\r\n                            left: 0,\r\n                            bottom: 1,\r\n                            right: 1\r\n                        }\r\n                    },\r\n                    autoScroll: true,\r\n                    onmove: function (event) {\r\n                        const {target} = event;\r\n                        // keep the dragged position in the data-x/data-y attributes\r\n                        const datax = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;\r\n                        const datay = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\r\n\r\n                        // translate the element\r\n                        const elementTransform = 'translate(' + datax + 'px, ' + datay + 'px)';\r\n                        target.style.webkitTransform = elementTransform;\r\n                        target.style.transform = elementTransform;\r\n\r\n                        // update the position attributes\r\n                        target.setAttribute('data-x', datax);\r\n                        target.setAttribute('data-y', datay);\r\n                    },\r\n                    onend: function (event) {\r\n                        const {target} = event;\r\n\r\n                        const imageHeight = image.offsetHeight;\r\n                        const imageWidth = image.offsetWidth;\r\n\r\n                        // find sensor with the id from the refId attribute on html\r\n                        const sensor = _.find(ctrl.panel.sensors, {\r\n                            'id': (event.target).getAttribute('refId')\r\n                        });\r\n\r\n                        // get relative distance in px\r\n                        const datax = target.getAttribute('data-x');\r\n                        const datay = target.getAttribute('data-y');\r\n\r\n                        // get percentage of relative distance from starting point\r\n                        const xpercentage = (datax * 100) / imageWidth;\r\n                        const ypercentage = (datay * 100) / imageHeight;\r\n\r\n                        sensor.xlocation += xpercentage;\r\n                        sensor.ylocation += ypercentage;\r\n\r\n                        // reset the starting sensor points\r\n                        target.setAttribute('data-x', 0);\r\n                        target.setAttribute('data-y', 0);\r\n\r\n                        // target.style.webkitTransform = '';\r\n                        target.style.transform = '';\r\n\r\n                        target.style.left = (sensor.xlocation * imageWidth / 100) + 'px';\r\n                        target.style.top = (sensor.ylocation * imageHeight / 100) + 'px';\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        this.events.on('render', function () {\r\n            render();\r\n            ctrl.renderingCompleted();\r\n        });\r\n    }\r\n\r\n    //------------------\r\n    // Mapping stuff\r\n    //------------------\r\n\r\n    addValueMappingMap() {\r\n        this.panel.valueMappings.push(new ValueColorMapping());\r\n    }\r\n\r\n    removeValueMappingMap(index) {\r\n        this.panel.valueMappings.splice(index, 1);\r\n        this.render();\r\n    }\r\n\r\n    replaceTokens(originalValue) {\r\n        let value = originalValue;\r\n\r\n        if (!value) {\r\n            return value;\r\n        }\r\n        value += '';\r\n        value = value.split(' ').map((a) => {\r\n            if (a.startsWith('_fa-') && a.endsWith('_')) {\r\n                const icon = a.replace(/_/g, '').split(',')[0];\r\n                const color = a.indexOf(',') > -1 ? ` style=\"color:${normalizeColor(a.replace(/_/g, '').split(',')[1])}\" ` : '';\r\n                const repeatCount = a.split(',').length > 2 ? +(a.replace(/_/g, '').split(',')[2]) : 1;\r\n                a = `<i class=\"fa ${icon}\" ${color}></i> `.repeat(repeatCount);\r\n            } else if (a.startsWith('_img-') && a.endsWith('_')) {\r\n                a = a.slice(0, -1);\r\n                const imgUrl = a.replace('_img-', '').split(',')[0];\r\n                const imgWidth = a.split(',').length > 1 ? a.replace('_img-', '').split(',')[1] : '20px';\r\n                const imgHeight = a.split(',').length > 2 ? a.replace('_img-', '').split(',')[2] : '20px';\r\n                const repeatCount = a.split(',').length > 3 ? +(a.replace('_img-', '').split(',')[3]) : 1;\r\n                a = `<img width=\"${imgWidth}\" height=\"${imgHeight}\" src=\"${imgUrl}\"/>`.repeat(repeatCount);\r\n            }\r\n            return a;\r\n        }).join(' ');\r\n\r\n        return this.$sce.trustAsHtml(value);\r\n    }\r\n\r\n    getMappingOperators() {\r\n        return getMappingOperators();\r\n    }\r\n}\r\n\r\nfunction isEqualTo(a, b) {\r\n    // Could be ok if Im comparing strings and numbers\r\n    // eslint-disable-next-line eqeqeq\r\n    return (a !== undefined && b !== undefined) ? a == b : false;\r\n}\r\n\r\nfunction isGreaterThan(a, b) {\r\n    return (a !== undefined && b !== undefined) ? a > b : false;\r\n}\r\n\r\nfunction isLessThan(a, b) {\r\n    return (a !== undefined && b !== undefined) ? a < b : false;\r\n}\r\n\r\nfunction getMappingOperators() {\r\n    return mappingOperators;\r\n}\r\n\r\nfunction getRandomId() {\r\n    return '_' + Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\nfunction ValueColorMapping() {\r\n    // TODO: check if it doesnt exist yet\r\n    this.id = getRandomId();\r\n    this.name = undefined;\r\n    this.operatorName = mappingOperators[0].name;\r\n    this.compareTo = undefined;\r\n    this.isSensorFontBold = false;\r\n    this.fontColor = '#000';\r\n    this.bgColor = '#fff';\r\n    this.nameBlink = false;\r\n    this.valueBlink = false;\r\n    this.bgBlink = false;\r\n}\r\n\r\nfunction Sensor() {\r\n    this.metric = '';\r\n    this.xlocation = 50;\r\n    this.ylocation = 25;\r\n    this.bgColor = 'rgba(64,64,64,1.000)';\r\n    this.fontColor = 'rgba(255,255,255,1.000)';\r\n    this.size = 14;\r\n    this.visible = true;\r\n    this.renderValue = true;\r\n    this.valueFormatted = '';\r\n    this.valueUnit = '';\r\n    this.displayName = '';\r\n    this.link_url = '';\r\n    this.resolvedLink = '';\r\n    this.rectangular = true;\r\n    this.valueMappingIds = [];\r\n    this.isBold = false;\r\n    this.id = getRandomId();\r\n    this.unitFormat = 'none';\r\n    this.decimals = 2;\r\n\r\n    this.setUnitFormat = function (subItem) {\r\n        this.unitFormat = subItem.value;\r\n    };\r\n}\r\n\r\nfunction normalizeColor(color) {\r\n    if (color.toLowerCase() === 'green') {\r\n        return 'rgba(50, 172, 45, 0.97)';\r\n    } if (color.toLowerCase() === 'orange') {\r\n        return 'rgba(237, 129, 40, 0.89)';\r\n    } if (color.toLowerCase() === 'red') {\r\n        return 'rgba(245, 54, 54, 0.9)';\r\n    }\r\n    return color.toLowerCase();\r\n}\r\n\r\nImageItCtrl.templateUrl = 'module.html';\r\n"],"file":"imageit_ctrl.js"}
=======
{"version":3,"sources":["../src/imageit_ctrl.js"],"names":["isEqualTo","a","b","undefined","isGreaterThan","isLessThan","getMappingOperators","mappingOperators","getRandomId","Math","random","toString","substr","ValueColorMapping","id","name","operatorName","compareTo","isSensorFontBold","fontColor","bgColor","nameBlink","valueBlink","bgBlink","Sensor","metric","xlocation","ylocation","size","visible","renderValue","valueFormatted","valueUnit","displayName","link_url","resolvedLink","rectangular","valueMappingIds","isBold","unitFormat","decimals","sizeCoefficient","setUnitFormat","subItem","value","normalizeColor","color","toLowerCase","_","MetricsPanelCtrl","getValueFormat","kbn","panelDefaults","colorMappings","colorMappingMap","valueMappings","metricValues","seriesList","series","bgimage","sensors","templateSrv","sizecoefficient","uncache","islocked","operator","fn","isTheFirstRender","ImageItCtrl","$scope","$injector","$sce","defaults","panel","events","on","onInitEditMode","bind","render","onDataReceived","dataList","dataListLength","length","push","target","datapoints","refreshImage","index","splice","sensor","addEditorTab","unitFormats","getUnitFormats","scope","elem","attrs","ctrl","panelContainer","find","image","querySelector","draggableElement","metricMap","keyBy","valueMappingsMap","mapping","mappingOperatorsMap","imageWidth","offsetWidth","sizeStr","borderRadius","replace","effectiveName","metricValue","valueMapping","mappingOperatorName","mappingId","mappingOperator","realFontColor","realBgColor","normalizeSensor","formatFunc","dragEventSetup","window","interact","isSet","unset","draggable","inertia","restrict","restriction","endOnly","elementRect","top","left","bottom","right","autoScroll","onmove","event","datax","parseFloat","getAttribute","dx","datay","dy","elementTransform","style","webkitTransform","transform","setAttribute","onend","imageHeight","offsetHeight","xpercentage","ypercentage","newX","parseInt","round","newY","renderingCompleted","originalValue","split","map","startsWith","endsWith","icon","indexOf","repeatCount","repeat","slice","imgUrl","imgWidth","imgHeight","join","trustAsHtml","templateUrl"],"mappings":"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","sourcesContent":["/* eslint-disable class-methods-use-this */\r\n/* eslint-disable func-names */\r\n/* eslint-disable no-restricted-syntax */\r\n/* eslint-disable import/prefer-default-export */\r\nimport _ from 'lodash';\r\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport { getValueFormat } from '@grafana/ui';\r\nimport './libs/interact';\r\nimport kbn from 'app/core/utils/kbn';\r\n\r\nconst panelDefaults = {\r\n    colorMappings: [],\r\n    colorMappingMap: [],\r\n    valueMappings: [],\r\n    metricValues: [],\r\n    seriesList: [],\r\n    series: [],\r\n    bgimage: '',\r\n    sensors: [],\r\n    templateSrv: null,\r\n    sizecoefficient: 20,\r\n    // uncache is a random number added to the img url to refresh it\r\n    uncache: 0,\r\n    islocked: false\r\n};\r\n\r\nconst mappingOperators = [{\r\n    name: 'equal',\r\n    operator: '=',\r\n    fn: isEqualTo\r\n}, {\r\n    name: 'greaterThan',\r\n    operator: '>',\r\n    fn: isGreaterThan\r\n}, {\r\n    name: 'lessThan',\r\n    operator: '<',\r\n    fn: isLessThan\r\n}];\r\n\r\nlet isTheFirstRender = true;\r\n\r\nexport class ImageItCtrl extends MetricsPanelCtrl {\r\n    constructor($scope, $injector, $sce, templateSrv) {\r\n        super($scope, $injector);\r\n        _.defaults(this.panel, panelDefaults);\r\n        this.templateSrv = templateSrv;\r\n        this.$sce = $sce;\r\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n        this.events.on('panel-initialized', this.render.bind(this));\r\n        this.events.on('data-received', this.onDataReceived.bind(this));\r\n        this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n    }\r\n\r\n    onDataReceived(dataList) {\r\n        const dataListLength = dataList.length;\r\n        this.panel.metricValues = [];\r\n        for (let series = 0; series < dataListLength; series += 1) {\r\n            this.panel.metricValues.push({\r\n                name: dataList[series].target,\r\n                value: dataList[series].datapoints[dataList[series].datapoints.length - 1][0]\r\n            });\r\n        }\r\n\r\n        if (!isTheFirstRender) {\r\n            this.refreshImage();\r\n        } else {\r\n            isTheFirstRender = false;\r\n        }\r\n\r\n\r\n        this.render();\r\n    }\r\n\r\n    refreshImage() {\r\n        this.panel.uncache = Math.random();\r\n    }\r\n\r\n    deleteSensor(index) {\r\n        this.panel.sensors.splice(index, 1);\r\n    }\r\n\r\n    addSensor() {\r\n        this.panel.sensors.push(\r\n            new Sensor()\r\n        );\r\n    }\r\n\r\n    moveSensorUp(index) {\r\n        const sensor = this.panel.sensors[index];\r\n        this.panel.sensors.splice(index, 1);\r\n        this.panel.sensors.splice(index - 1, 0, sensor);\r\n    }\r\n\r\n    moveSensorDown(index) {\r\n        const sensor = this.panel.sensors[index];\r\n        this.panel.sensors.splice(index, 1);\r\n        this.panel.sensors.splice(index + 1, 0, sensor);\r\n    }\r\n\r\n    onInitEditMode() {\r\n        this.addEditorTab('Sensor', 'public/plugins/pierosavi-imageit-panel/editor.html', 2);\r\n        this.addEditorTab('Value Mapping', 'public/plugins/pierosavi-imageit-panel/mappings.html', 3);\r\n        this.unitFormats = kbn.getUnitFormats();\r\n        this.render();\r\n    }\r\n\r\n    toggleBlock() {\r\n        this.panel.islocked = !this.panel.islocked;\r\n        this.render();\r\n    }\r\n\r\n    link(scope, elem, attrs, ctrl) {\r\n        const panelContainer = (elem.find('.pierosavi-imageit-panel')[0]);\r\n        const image = (panelContainer.querySelector('#imageit-image'));\r\n        const draggableElement = '#imageit_panel' + ctrl.panel.id + '_sensor';\r\n\r\n        function render() {\r\n            if (!ctrl.panel.sensors || (ctrl.panel.bgimage === '')) {\r\n                return;\r\n            }\r\n\r\n            const metricMap = _.keyBy(ctrl.panel.metricValues, value => value.name);\r\n            const valueMappingsMap = _.keyBy(ctrl.panel.valueMappings, mapping => mapping.id);\r\n            const mappingOperatorsMap = _.keyBy(mappingOperators, operator => operator.name);\r\n\r\n            for (const sensor of ctrl.panel.sensors) {\r\n                _.defaults(sensor, new Sensor());\r\n\r\n                const imageWidth = image.offsetWidth;\r\n                const sizeCoefficient = sensor.sizeCoefficient ? sensor.sizeCoefficient : ctrl.panel.sizecoefficient;\r\n\r\n                sensor.size = imageWidth * sizeCoefficient / 1600;\r\n                sensor.sizeStr = sensor.size.toString() + 'px';\r\n\r\n                sensor.borderRadius = sensor.rectangular ? '5%' : '50%';\r\n\r\n                if (sensor.link_url !== undefined) {\r\n                    sensor.resolvedLink = ctrl.templateSrv.replace(sensor.link_url);\r\n                }\r\n\r\n                // We need to replace possible variables in the sensors name\r\n                const effectiveName = ctrl.templateSrv.replace(sensor.metric);\r\n\r\n                const metric = metricMap[effectiveName];\r\n\r\n                const metricValue = (metric !== undefined) ? metric.value : undefined;\r\n\r\n                // update existing valueMappings\r\n                for (const valueMapping of ctrl.panel.valueMappings) {\r\n                    if (valueMapping.mappingOperatorName == null) {\r\n                        valueMapping.mappingOperatorName = mappingOperators[0].name;\r\n                    }\r\n\r\n                    if (valueMapping.id == null) {\r\n                        valueMapping.id = getRandomId();\r\n                    }\r\n                }\r\n\r\n                if (sensor.valueMappingIds === undefined) {\r\n                    sensor.valueMappingIds = [];\r\n                }\r\n\r\n                if (sensor.valueMappingIds.length > 0) {\r\n                    for (const mappingId of sensor.valueMappingIds) {\r\n                        const valueMapping = valueMappingsMap[mappingId];\r\n\r\n                        if (valueMapping === undefined) {\r\n                            break;\r\n                        }\r\n\r\n                        const mappingOperator = mappingOperatorsMap[valueMapping.mappingOperatorName];\r\n\r\n                        if (mappingOperator.fn(metricValue, valueMapping.compareTo)) {\r\n                            sensor.realFontColor = valueMapping.fontColor;\r\n                            sensor.realBgColor = valueMapping.bgColor;\r\n\r\n                            sensor.nameBlink = valueMapping.nameBlink;\r\n                            sensor.valueBlink = valueMapping.valueBlink;\r\n                            sensor.bgBlink = valueMapping.bgBlink;\r\n\r\n                            sensor.isBold = valueMapping.isSensorFontBold;\r\n\r\n                            break;\r\n                        } else {\r\n                            normalizeSensor(sensor);\r\n                        }\r\n                    }\r\n                } else {\r\n                    normalizeSensor(sensor);\r\n                }\r\n\r\n                if (metricValue === undefined) {\r\n                    sensor.valueFormatted = 'Select a sensor metric';\r\n                } else {\r\n                    const formatFunc = getValueFormat(sensor.unitFormat);\r\n                    sensor.valueFormatted = formatFunc(metricValue, sensor.decimals);\r\n                }\r\n            }\r\n\r\n            dragEventSetup();\r\n        }\r\n\r\n        function normalizeSensor(sensor) {\r\n            // new sensor property so it doesn't lose the original one\r\n            // https://github.com/pierosavi/pierosavi-imageit-panel/issues/4\r\n            sensor.realBgColor = sensor.bgColor;\r\n            sensor.realFontColor = sensor.fontColor;\r\n\r\n            sensor.nameBlink = false;\r\n            sensor.valueBlink = false;\r\n            sensor.bgBlink = false;\r\n\r\n            sensor.isBold = false;\r\n        }\r\n\r\n        function dragEventSetup() {\r\n            if (ctrl.panel.islocked) {\r\n                if (window.interact.isSet(draggableElement)) {\r\n                    window.interact(draggableElement).unset();\r\n                }\r\n            } else if (!window.interact.isSet(draggableElement)) {\r\n                window.interact(draggableElement).draggable({\r\n                    // I dont like it personally but this could be configurable in the future\r\n                    inertia: false,\r\n                    restrict: {\r\n                        restriction: '#draggableparent',\r\n                        endOnly: true,\r\n                        elementRect: {\r\n                            top: 0,\r\n                            left: 0,\r\n                            bottom: 1,\r\n                            right: 1\r\n                        }\r\n                    },\r\n                    autoScroll: true,\r\n                    onmove: function (event) {\r\n                        const {target} = event;\r\n                        // keep the dragged position in the data-x/data-y attributes\r\n                        const datax = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx;\r\n                        const datay = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\r\n\r\n                        // translate the element\r\n                        const elementTransform = 'translate(' + datax + 'px, ' + datay + 'px)';\r\n                        target.style.webkitTransform = elementTransform;\r\n                        target.style.transform = elementTransform;\r\n\r\n                        // update the position attributes\r\n                        target.setAttribute('data-x', datax);\r\n                        target.setAttribute('data-y', datay);\r\n                    },\r\n                    onend: function (event) {\r\n                        const {target} = event;\r\n\r\n                        const imageHeight = image.offsetHeight;\r\n                        const imageWidth = image.offsetWidth;\r\n\r\n                        const datax = target.getAttribute('data-x');\r\n                        const datay = target.getAttribute('data-y');\r\n\r\n                        // get percentage of relative distance from starting point\r\n                        const xpercentage = (datax * 100) / imageWidth;\r\n                        const ypercentage = (datay * 100) / imageHeight;\r\n\r\n                        // browsers dont render more than 4 decimals so better cut away the others\r\n                        let newX = parseInt(target.style.left, 10) + xpercentage;\r\n                        newX = Math.round(newX * 10000) / 10000;\r\n\r\n                        let newY = parseInt(target.style.top, 10) + ypercentage;\r\n                        newY = Math.round(newY * 10000) / 10000;\r\n\r\n                        const elementTransform = 'translate(0px, 0px)';\r\n                        target.style.webkitTransform = elementTransform;\r\n                        target.style.transform = elementTransform;\r\n\r\n                        // manually set the new style so I don't need to render() again\r\n                        target.style.left = newX + '%';\r\n                        target.style.top = newY + '%';\r\n\r\n                        // really update the sensor values\r\n\r\n                        // find sensor with the id from the refId attribute on html\r\n                        const sensor = _.find(ctrl.panel.sensors, {\r\n                            'id': (event.target).getAttribute('refId')\r\n                        });\r\n\r\n                        sensor.xlocation = newX;\r\n                        sensor.ylocation = newY;\r\n\r\n                        // reset the starting sensor points\r\n                        target.setAttribute('data-x', 0);\r\n                        target.setAttribute('data-y', 0);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        this.events.on('render', function () {\r\n            render();\r\n            ctrl.renderingCompleted();\r\n        });\r\n    }\r\n\r\n    //------------------\r\n    // Mapping stuff\r\n    //------------------\r\n\r\n    addValueMappingMap() {\r\n        this.panel.valueMappings.push(new ValueColorMapping());\r\n    }\r\n\r\n    removeValueMappingMap(index) {\r\n        this.panel.valueMappings.splice(index, 1);\r\n        this.render();\r\n    }\r\n\r\n    replaceTokens(originalValue) {\r\n        let value = originalValue;\r\n\r\n        if (!value) {\r\n            return value;\r\n        }\r\n        value += '';\r\n        value = value.split(' ').map((a) => {\r\n            if (a.startsWith('_fa-') && a.endsWith('_')) {\r\n                const icon = a.replace(/_/g, '').split(',')[0];\r\n                const color = a.indexOf(',') > -1 ? ` style=\"color:${normalizeColor(a.replace(/_/g, '').split(',')[1])}\" ` : '';\r\n                const repeatCount = a.split(',').length > 2 ? +(a.replace(/_/g, '').split(',')[2]) : 1;\r\n                a = `<i class=\"fa ${icon}\" ${color}></i> `.repeat(repeatCount);\r\n            } else if (a.startsWith('_img-') && a.endsWith('_')) {\r\n                a = a.slice(0, -1);\r\n                const imgUrl = a.replace('_img-', '').split(',')[0];\r\n                const imgWidth = a.split(',').length > 1 ? a.replace('_img-', '').split(',')[1] : '20px';\r\n                const imgHeight = a.split(',').length > 2 ? a.replace('_img-', '').split(',')[2] : '20px';\r\n                const repeatCount = a.split(',').length > 3 ? +(a.replace('_img-', '').split(',')[3]) : 1;\r\n                a = `<img width=\"${imgWidth}\" height=\"${imgHeight}\" src=\"${imgUrl}\"/>`.repeat(repeatCount);\r\n            }\r\n            return a;\r\n        }).join(' ');\r\n\r\n        return this.$sce.trustAsHtml(value);\r\n    }\r\n\r\n    getMappingOperators() {\r\n        return getMappingOperators();\r\n    }\r\n}\r\n\r\nfunction isEqualTo(a, b) {\r\n    // Could be ok if Im comparing strings and numbers\r\n    // eslint-disable-next-line eqeqeq\r\n    return (a !== undefined && b !== undefined) ? a == b : false;\r\n}\r\n\r\nfunction isGreaterThan(a, b) {\r\n    return (a !== undefined && b !== undefined) ? a > b : false;\r\n}\r\n\r\nfunction isLessThan(a, b) {\r\n    return (a !== undefined && b !== undefined) ? a < b : false;\r\n}\r\n\r\nfunction getMappingOperators() {\r\n    return mappingOperators;\r\n}\r\n\r\nfunction getRandomId() {\r\n    return '_' + Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\nfunction ValueColorMapping() {\r\n    // TODO: check if it doesnt exist yet\r\n    this.id = getRandomId();\r\n    this.name = undefined;\r\n    this.operatorName = mappingOperators[0].name;\r\n    this.compareTo = undefined;\r\n    this.isSensorFontBold = false;\r\n    this.fontColor = '#000';\r\n    this.bgColor = '#fff';\r\n    this.nameBlink = false;\r\n    this.valueBlink = false;\r\n    this.bgBlink = false;\r\n}\r\n\r\nfunction Sensor() {\r\n    this.metric = '';\r\n    this.xlocation = 50;\r\n    this.ylocation = 25;\r\n    this.bgColor = 'rgba(64,64,64,1.000)';\r\n    this.fontColor = 'rgba(255,255,255,1.000)';\r\n    this.size = 14;\r\n    this.visible = true;\r\n    this.renderValue = true;\r\n    this.valueFormatted = '';\r\n    this.valueUnit = '';\r\n    this.displayName = '';\r\n    this.link_url = '';\r\n    this.resolvedLink = '';\r\n    this.rectangular = true;\r\n    this.valueMappingIds = [];\r\n    this.isBold = false;\r\n    this.id = getRandomId();\r\n    this.unitFormat = 'none';\r\n    this.decimals = 2;\r\n    this.sizeCoefficient = undefined;\r\n\r\n    this.setUnitFormat = function (subItem) {\r\n        this.unitFormat = subItem.value;\r\n    };\r\n}\r\n\r\nfunction normalizeColor(color) {\r\n    if (color.toLowerCase() === 'green') {\r\n        return 'rgba(50, 172, 45, 0.97)';\r\n    }\r\n    if (color.toLowerCase() === 'orange') {\r\n        return 'rgba(237, 129, 40, 0.89)';\r\n    }\r\n    if (color.toLowerCase() === 'red') {\r\n        return 'rgba(245, 54, 54, 0.9)';\r\n    }\r\n    return color.toLowerCase();\r\n}\r\n\r\nImageItCtrl.templateUrl = 'module.html';\r\n"],"file":"imageit_ctrl.js"}
>>>>>>> master
